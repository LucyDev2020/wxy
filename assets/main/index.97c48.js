window.__require=function e(t,o,r){function n(a,s){if(!o[a]){if(!t[a]){var c=a.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(i)return i(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var h=o[a]={exports:{}};t[a][0].call(h.exports,function(e){return n(t[a][1][e]||e)},h,h.exports,e,t,o,r)}return o[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<r.length;a++)n(r[a]);return n}({BulletBase:[function(e,t,o){"use strict";cc._RF.push(t,"f09e2vRhAdLJbJGSNeYJZr/","BulletBase");var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=(a.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.damage=4,t.enemyTarget=null,t.enemyTargetPos=null,t.moveFPS=0,t.startPos=null,t.direction=null,t.directionV2=null,t}return n(t,e),t.prototype.init=function(e,t,o){if(this.damage=e,this.enemyTarget=t,this.startPos=o,t){this.direction=t.position.sub(o).normalize(),this.directionV2=cc.v2(this.direction.x,this.direction.y),this.node.position=o;var r=cc.v2(cc.v2(0,-1)).signAngle(this.directionV2),n=180/Math.PI*r;this.node.angle=n;var i=t.getPosition();this.enemyTargetPos=cc.v3(i.x,i.y,0);var a=t.getComponent("Enemy");a&&a.getEnemyId()}},t.prototype.start=function(){},i([s],t)}(cc.Component));o.default=c,cc._RF.pop()},{}],BulletRocket:[function(e,t,o){"use strict";cc._RF.push(t,"159908io71Of4OPz8VpuCHZ","BulletRocket");var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./BulletBase"),s=e("./GameConst"),c=e("./EventMananger"),l=cc._decorator,h=l.ccclass,p=(l.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=5,t}return n(t,e),t.prototype.reuse=function(e,t,o,r){this.pool=e,this.init(t,o,r)},t.prototype.unuse=function(){},t.prototype.start=function(){},t.prototype.remove=function(){this.node&&(this.enemyTarget=null,this.enemyTargetPos=null,this.pool?this.pool.put(this.node):this.node.isValid&&this.node.destroy())},t.prototype.isArriveTargetPos=function(){return!!this.enemyTargetPos&&this.enemyTargetPos.sub(this.node.position).mag()<=5},t.prototype.isTargetAlive=function(){if(this.enemyTarget&&this.enemyTarget.isValid&&this.enemyTarget.active){var e=this.enemyTarget.getComponent("Enemy");if(e)return!e.isDead()}return!1},t.prototype.showExplodeEffect=function(){var e=this.node.getPosition(),t=this.damage;c.EventMananger.getInstance().sendEvent(s.GameConst.EVENT_CREATOR_EXPLODE_EFFECT,e,t)},t.prototype.move=function(){if(this.isArriveTargetPos())return this.showExplodeEffect(),void this.remove();this.enemyTargetPos?(this.enemyTargetPos.sub(this.node.position).mag()<=this.speed?this.node.setPosition(this.enemyTargetPos):(this.direction=this.enemyTargetPos.sub(this.node.position).normalize(),this.node.position=this.node.position.add(this.direction.mul(this.speed))),(this.node.position.x<-(this.node.width+cc.winSize.width)/2||this.node.position.x>(this.node.width+cc.winSize.width)/2||this.node.position.y>(cc.winSize.height+this.node.height)/2||this.node.position.y<-(cc.winSize.height+this.node.height)/2)&&(this.remove(),cc.log("\u5c4f\u5e55\u5916\u5220\u6389\u5b50\u5f39"))):this.remove()},t.prototype.update=function(){this.node&&(this.moveFPS<s.GameConst.ENEMY_MOVE_FPS-1?this.moveFPS++:(this.moveFPS=0,this.move()))},i([h],t)}(a.default));o.default=p,cc._RF.pop()},{"./BulletBase":"BulletBase","./EventMananger":"EventMananger","./GameConst":"GameConst"}],BulletTurret:[function(e,t,o){"use strict";cc._RF.push(t,"a16aai99qNA+50jiMuZQMtQ","BulletTurret");var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./BulletBase"),s=e("./GameConst"),c=cc._decorator,l=c.ccclass,h=(c.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=30,t}return n(t,e),t.prototype.reuse=function(e,t,o,r){this.pool=e,this.init(t,o,r)},t.prototype.unuse=function(){},t.prototype.start=function(){},t.prototype.onCollisionEnter=function(e){if(e.node&&e.node.isValid&&e.node.active){var t=e.node.getComponent("Enemy");if(t){var o=t.getEnemyId();if(this.isTargetAlive()){var r=this.enemyTarget.getComponent("Enemy");r&&o==r.getEnemyId()&&(r.beHit(this.damage),this.remove())}else this.remove()}}},t.prototype.remove=function(){this.node&&(this.enemyTarget=null,this.enemyTargetPos=null,this.pool?this.pool.put(this.node):this.node.isValid&&this.node.destroy())},t.prototype.isArriveTargetPos=function(){return!!this.enemyTargetPos&&this.enemyTargetPos.sub(this.node.position).mag()<=5},t.prototype.isTargetAlive=function(){if(this.enemyTarget&&this.enemyTarget.isValid&&this.enemyTarget.active){var e=this.enemyTarget.getComponent("Enemy");if(e)return!e.isDead()}return!1},t.prototype.move=function(){if(this.isTargetAlive()){if(this.enemyTarget){var e=this.enemyTarget.getPosition();this.enemyTargetPos=cc.v3(e.x,e.y,0)}}else if(this.enemyTarget=null,this.isArriveTargetPos())return void this.remove();this.enemyTargetPos?(this.enemyTargetPos.sub(this.node.position).mag()<=this.speed?this.node.setPosition(this.enemyTargetPos):(this.direction=this.enemyTargetPos.sub(this.node.position).normalize(),this.node.position=this.node.position.add(this.direction.mul(this.speed))),(this.node.position.x<-(this.node.width+cc.winSize.width)/2||this.node.position.x>(this.node.width+cc.winSize.width)/2||this.node.position.y>(cc.winSize.height+this.node.height)/2||this.node.position.y<-(cc.winSize.height+this.node.height)/2)&&(this.remove(),cc.log("\u5c4f\u5e55\u5916\u5220\u6389\u5b50\u5f39"))):this.remove()},t.prototype.update=function(){this.node&&(this.moveFPS<s.GameConst.ENEMY_MOVE_FPS-1?this.moveFPS++:(this.moveFPS=0,this.move()))},i([l],t)}(a.default));o.default=h,cc._RF.pop()},{"./BulletBase":"BulletBase","./GameConst":"GameConst"}],DrawBg:[function(e,t,o){"use strict";cc._RF.push(t,"6328fgjjftAoaZg/T3oergZ","DrawBg");var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=0,t.radius=10,t.color=cc.Color.WHITE,t.colorFill=cc.Color.WHITE,t}return n(t,e),t.prototype.start=function(){this.render()},t.prototype.render=function(){var e=this.getComponent(cc.Graphics),t=(this.node.width,this.node.height);e.clear();var o=this.node.position.x,r=this.node.position.y;e.fillColor=this.colorFill,e.circle(o,r,t/2),e.fill(),1==this.type&&(e.strokeColor=this.color,e.circle(o,r,t/2),e.stroke())},i([c],t.prototype,"type",void 0),i([c],t.prototype,"radius",void 0),i([c(cc.Color)],t.prototype,"color",void 0),i([c(cc.Color)],t.prototype,"colorFill",void 0),i([s],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],DrawFrame:[function(e,t,o){"use strict";cc._RF.push(t,"b7c8cyv1f1NsKBtvQRmTqTq","DrawFrame");var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._type=1,t.rectCorn=20,t._color=cc.Color.WHITE,t._colorFill=cc.Color.BLACK,t._colorDisable=cc.Color.WHITE,t._colorDisableFill=cc.Color.BLACK,t._disable=!1,t}return n(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e,this.render()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e,this.render()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorFill",{get:function(){return this._colorFill},set:function(e){this._colorFill=e,this.render()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorDisable",{get:function(){return this._colorDisable},set:function(e){this._colorDisable=e,this.render()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorDisableFill",{get:function(){return this._colorDisableFill},set:function(e){this._colorDisableFill=e,this.render()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disable",{get:function(){return this._disable},set:function(e){this._disable=e,this.render()},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.render()},t.prototype.setDisable=function(e){this.disable=e,this.render()},t.prototype.render=function(){var e=this.getComponent(cc.Graphics),t=this.node.width,o=this.node.height;e.lineCap=cc.Graphics.LineCap.ROUND,e.lineJoin=cc.Graphics.LineJoin.ROUND,e.clear();var r=this.node.position.x-t/2,n=this.node.position.y-o/2;!0===this.disable?(e.fillColor=this.colorDisableFill,e.strokeColor=this.colorDisable):(e.fillColor=this.colorFill,e.strokeColor=this.color);var i=this.rectCorn;0==this.type?(e.roundRect(r,n,t,o,i),e.fill()):1==this.type?(e.roundRect(r,n,t,o,i),e.fill(),e.roundRect(r,n,t,o,i),e.stroke()):3==this.type?(e.roundRect(r,n,t,o,o/2),e.fill()):(e.roundRect(r,n,t,o,i),e.stroke())},i([c()],t.prototype,"_type",void 0),i([c()],t.prototype,"rectCorn",void 0),i([c(cc.Color)],t.prototype,"_color",void 0),i([c(cc.Color)],t.prototype,"_colorFill",void 0),i([c(cc.Color)],t.prototype,"_colorDisable",void 0),i([c(cc.Color)],t.prototype,"_colorDisableFill",void 0),i([c()],t.prototype,"_disable",void 0),i([c()],t.prototype,"type",null),i([c()],t.prototype,"color",null),i([c()],t.prototype,"colorFill",null),i([c()],t.prototype,"colorDisable",null),i([c()],t.prototype,"colorDisableFill",null),i([c()],t.prototype,"disable",null),i([s],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],Enemy:[function(e,t,o){"use strict";cc._RF.push(t,"fc6abpUFEBNAqxo3bX3aGVx","Enemy");var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./GameConst"),s=e("./EventMananger"),c=cc._decorator,l=c.ccclass,h=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=a.GameConst.ENEMY.NORMAL,t.startPos=null,t.pathPosWithNextDir=new Array,t.path=null,t.step=0,t.stepTotal=0,t.speed=0,t.dir=0,t.coins=1,t.hp=10,t.hpTotal=10,t.moveFPS=0,t.enemyId=0,t}return n(t,e),t.prototype.reuse=function(e,t,o,r,n,i,a){this.pool=e,this.init(t,o,r,n,i,a)},t.prototype.unuse=function(){},t.prototype.beHit=function(e){if(e>0&&!this.isDead())if(this.hp-=e,this.hp<=0)this.hp=0,s.EventMananger.getInstance().sendEvent(a.GameConst.EVENT_ENEMY_DEAD,this.coins),this.remove();else if(this.node){var t=this.hp/this.hpTotal;t<.3&&(t=.3),this.node.scale=t}},t.prototype.isDead=function(){return!(this.node&&this.node.isValid&&this.node.active)||this.hp<=0},t.prototype.remove=function(){this.node&&(s.EventMananger.getInstance().sendEvent(a.GameConst.EVENT_REMOVE_ENEMY,this.enemyId),this.pool?this.pool.put(this.node):this.node.isValid&&this.node.destroy())},t.prototype.initWithPool=function(e,t,o,r,n,i,a){this.pool=r,this.init(e,t,o,n,i,a)},t.prototype.init=function(e,t,o,r,n,i){this.pathPosWithNextDir=e,this.startPos=t,this.node.setPosition(t),this.node.scale=1,this.step=0,this.dir=o,this.stepTotal=this.pathPosWithNextDir.length;var s=.4,c=.6;switch(this.hp=r,this.hpTotal=r,this.enemyId=i,this.coins=n,this.type){case a.GameConst.ENEMY.NORMAL:this.speed=Math.floor(a.GameConst.ENEMY_SPEED.NORMAL),s=.4,c=.6;break;case a.GameConst.ENEMY.FAST:this.speed=Math.floor(a.GameConst.ENEMY_SPEED.FAST),s=.5,c=.95;break;case a.GameConst.ENEMY.BOSS:this.speed=Math.floor(a.GameConst.ENEMY_SPEED.BOSS),s=.4,c=.6}this.switchDir(this.dir),this.startShow(s,c)},t.prototype.startShow=function(e,t){this.node&&(this.node.opacity=0,this.node.scale=t,cc.tween(this.node).to(e,{scale:1,opacity:255}).start())},t.prototype.start=function(){},t.prototype.getEnemyId=function(){return this.enemyId},t.prototype.getNextDir=function(){var e=-1;return this.pathPosWithNextDir&&this.step<this.stepTotal&&(e=this.pathPosWithNextDir[this.step].nextDir),e},t.prototype.switchDir=function(e){if(this.node)switch(e){case a.GameConst.DIR.TOP:this.node.angle=180;break;case a.GameConst.DIR.BOTTOM:this.node.angle=0;break;case a.GameConst.DIR.LEFT:this.node.angle=270;break;case a.GameConst.DIR.RIGHT:this.node.angle=90}},t.prototype.isArriveEnd=function(){return!!(this.pathPosWithNextDir&&this.step>this.stepTotal-1)},t.prototype.move=function(){if(this.isArriveEnd())return s.EventMananger.getInstance().sendEvent(a.GameConst.EVENT_ENEMY_ARRIVE_END),void this.remove();if(this.pathPosWithNextDir&&this.step<this.stepTotal){var e=this.pathPosWithNextDir[this.step].pos,t=this.node.getPosition();if(e.x>this.node.position.x){if(t.x+=this.speed,(r=t.x-e.x)>=0&&(t.x=e.x,t.y=e.y,!this.isArriveEnd())){var o=this.getNextDir();switch(r=Math.abs(r),o){case a.GameConst.DIR.TOP:t.y+=r;break;case a.GameConst.DIR.BOTTOM:t.y-=r;break;case a.GameConst.DIR.LEFT:t.x-=r;break;case a.GameConst.DIR.RIGHT:t.x+=r}this.switchDir(o),this.step++}}else if(e.x<this.node.position.x){var r;if(t.x-=this.speed,(r=t.x-e.x)<=0&&(t.x=e.x,t.y=e.y,!this.isArriveEnd())){switch(o=this.getNextDir(),r=Math.abs(r),o){case a.GameConst.DIR.TOP:t.y+=r;break;case a.GameConst.DIR.BOTTOM:t.y-=r;break;case a.GameConst.DIR.LEFT:t.x-=r;break;case a.GameConst.DIR.RIGHT:t.x+=r}this.switchDir(o),this.step++}}else if(e.y>this.node.position.y){if(t.y+=this.speed,(n=t.y-e.y)>=0&&(t.y=e.y,t.x=e.x,!this.isArriveEnd())){switch(o=this.getNextDir(),n=Math.abs(n),o){case a.GameConst.DIR.TOP:t.y+=n;break;case a.GameConst.DIR.BOTTOM:t.y-=n;break;case a.GameConst.DIR.LEFT:t.x-=n;break;case a.GameConst.DIR.RIGHT:t.x+=n}this.switchDir(o),this.step++}}else if(e.y<this.node.position.y){var n;if(t.y-=this.speed,(n=t.y-e.y)<=0&&(t.y=e.y,t.x=e.x,!this.isArriveEnd())){switch(o=this.getNextDir(),n=Math.abs(n),o){case a.GameConst.DIR.TOP:t.y+=n;break;case a.GameConst.DIR.BOTTOM:t.y-=n;break;case a.GameConst.DIR.LEFT:t.x-=n;break;case a.GameConst.DIR.RIGHT:t.x+=n}this.switchDir(o),this.step++}}else this.step++;this.node.setPosition(t)}},t.prototype.update=function(){this.isDead()||this.node&&(this.moveFPS<a.GameConst.ENEMY_MOVE_FPS-1?this.moveFPS++:(this.moveFPS=0,this.move()))},i([h],t.prototype,"type",void 0),i([l],t)}(cc.Component);o.default=p,cc._RF.pop()},{"./EventMananger":"EventMananger","./GameConst":"GameConst"}],EventMananger:[function(e,t,o){"use strict";cc._RF.push(t,"9fe8bKHuYlJmo3mPyzkT0sM","EventMananger"),Object.defineProperty(o,"__esModule",{value:!0}),o.EventMananger=void 0;var r=function(){function e(){this.eventList={}}return e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.sendEvent=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var r=this.eventList[e];if(null!=r)for(var n=r.length,i=void 0,a=void 0,s=n-1;s>=0;s--){var c=r[s];c?(i=c[0],a=c[1],i.apply(a,t)):console.log("msg null i="+s+",args="+t)}},e.prototype.addEvent=function(e,t,o){var r=this.eventList[e];if(null==r)r=[],this.eventList[e]=r;else for(var n=r.length,i=0;i<n;i++)if(r[i][0]==t&&r[i][1]==o)return;r.push([t,o])},e.prototype.removeEvent=function(e,t,o){var r=this.eventList[e];if(null!=r)for(var n=r.length-1;n>=0;n--)r[n][0]==t&&r[n][1]==o&&r.splice(n,1);r&&0==r.length&&(this.eventList[e]=null,delete this.eventList[e])},e}();o.EventMananger=r,cc._RF.pop()},{}],ExplodeEffect:[function(e,t,o){"use strict";cc._RF.push(t,"1a6e2uJpIlPd6pzNdAywGEq","ExplodeEffect");var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=(a.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.damage=0,t}return n(t,e),t.prototype.setDamage=function(e){this.damage=e},t.prototype.onCollisionEnter=function(e){if(e.node&&e.node.isValid&&e.node.active){var t=e.node.getComponent("Enemy");t&&(t.isDead()||(t.beHit(this.damage),this.removeCollision()))}},t.prototype.removeCollision=function(){var e=this;this.node&&this.scheduleOnce(function(){if(e.node){var t=e.node.getComponent(cc.Collider);t&&(t.enabled=!1)}},.2)},t.prototype.start=function(){},i([s],t)}(cc.Component));o.default=c,cc._RF.pop()},{}],GameConst:[function(e,t,o){"use strict";cc._RF.push(t,"b4a1eYK3XxBGafz7vgK0rBB","GameConst"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameConst=void 0;var r=function(){function e(){}return e.SPEED=1e3,e.MAP_GRID_WIDTH=93,e.MAP_GRID_HEIGHT=93,e.MAP_SIZE=93,e.AD_HEIGHT=120,e.MAP_MARGIN_BOTTOM=200,e.MAP_GRID_X=9,e.MAP_GRID_Y=11,e.YES=1,e.NO=0,e.CRYPT_KEY="tina",e.GAME_VERSION="Ver:1.0.0",e.GAME_VERSION_NUMBER=100,e.STAR_COUNT_EVERY_DAY=3,e.UNLOCK_MY_LEVEL_STAR_COUNT=200,e.UNLOCK_MY_LEVEL_GIRD_STAR_COUNT=5,e.UNLOCK_FIREND_LEVEL_GIRD_STAR_COUNT=5,e.MAP_ITEM_TYPE={NORMAL:0,ORIGIN:1,DESTINATION:2},e.DIR={TOP:0,BOTTOM:2,LEFT:3,RIGHT:1},e.TOWER_DIR={TOP:0,BOTTOM:1,LEFT:2,RIGHT:3,LEFT_TOP:4,LEFT_BOTTOM:5,RIGHT_TOP:6,RIGHT_BOTTOM:7},e.ENEMY={NORMAL:0,FAST:1,BOSS:2},e.ENEMY_SPEED={NORMAL:3.1,FAST:7.75,BOSS:3.1},e.TOWER_TURRET_SHOOT_FPS=18,e.TOWER_ROCKET_SHOOT_FPS=90,e.TOWER_LASER_SHOOT_FPS=300,e.TOWER_ACTION_FPS=2,e.ENEMY_MOVE_FPS=2,e.TOWER={NONE:0,TURRET:1,ROCKET:2,LASER:3,UPGRADE:4},e.TOWER_BUILD_COST={NONE:0,TURRET:50,ROCKET:50,LASER:50,UPGRADE:100},e.TOWER_SELL_PRICE={NONE:0,TURRET:20,ROCKET:20,LASER:20,UPGRADE:50},e.DATA_KEY_INIT="Key_Init",e.DATA_KEY_UUID="Key_uuid",e.DATA_KEY_CUR_BG_INDEX="Key_cur_bg_index",e.DATA_KEY_STAR_COUNT="Key_Star_Count",e.DATA_KEY_MY_LEVEL_GRID_STATE="Key_My_Level_Gird_State",e.DATA_KEY_FRIEND_LEVEL_GRID_STATE="Key_Friend_Level_Gird_State",e.DATA_KEY_RECORD_ON="Key_Record_On",e.DATA_KEY_CUR_LEVEL="Key_cur_level",e.DATA_KEY_CUR_LEVEL_GROUP="Key_cur_level_group",e.DATA_KEY_PASS_PLAYER_LEVEL="Key_pass_player_level",e.DATA_KEY_EDIT_LEVEL="Key_edit_level",e.DATA_KEY_EDIT_PASS_LEVEL="Key_edit_pass_level",e.DATA_KEY_RECEIVE_LEVEL="Key_Receive_level",e.DATA_KEY_UNLOCK_MY_LEVEL="Key_unlock_my_level",e.DATA_KEY_LAST_RECEIVE_LEVEL="Key_Last_Receive_level",e.DATA_KEY_UNLOCK_EASY_LEVEL_GROUP="Key_unlock_easy_level_group",e.DATA_KEY_UNLOCK_NORMAL_LEVEL_GROUP="Key_unlock_normal_level_group",e.DATA_KEY_UNLOCK_HARD_LEVEL_GROUP="Key_unlock_hard_level_group",e.DATA_KEY_UNLOCK_VERY_HARD_LEVEL_GROUP="Key_unlock_very_hard_level_group",e.DATA_KEY_TUTORIAL_LEVEL="Key_tutorial_level",e.DATA_KEY_EASY_LEVEL="Key_easy_level",e.DATA_KEY_NORMAL_LEVEL="Key_normal_level",e.DATA_KEY_HARD_LEVEL="Key_hard_level",e.DATA_KEY_VERY_HARD_LEVEL="Key_very_hard_level",e.DATA_KEY_SOUND_MUSIC="Key_Sound_MUSIC_2",e.DATA_KEY_SOUND_FX="Key_Sound_FX_2",e.DATA_KEY_DIAMOND="Key_Diamond",e.DATA_KEY_MAX_TIME="Key_Max_Time",e.DATA_KEY_MAX_DISTANCE="Key_Max_Distance",e.DATA_KEY_MAX_SCORE="Key_Max_Score",e.DATA_KEY_UNLOCK_MODE_CHALLENGE="Key_unlock_mode_challenge",e.DATA_KEY_UNLOCK_MODE_SURVIVAL="Key_unlock_mode_survival",e.DATA_KEY_NOT_FIRST_FETCH_SCO="Key_Not_First_Fetch_Sco",e.DATA_KEY_NOT_FIRST_FETCH_CHA="Key_Not_First_Fetch_Cha",e.DATA_KEY_NOT_FIRST_FETCH_SUR="Key_Not_First_Fetch_Sur",e.DATA_KEY_SCO_FETCH_TIMESTAMP="Key_ScoFetchTimestamp",e.DATA_KEY_CHA_FETCH_TIMESTAMP="Key_ChaFetchTimestamp",e.DATA_KEY_SUR_FETCH_TIMESTAMP="Key_SurFetchTimestamp",e.GAME_STATE_REPRARE=1,e.GAME_STATE_WAIT_START=2,e.GAME_STATE_START=3,e.GAME_STATE_PAUSE=4,e.GAME_STATE_GAME_OVER=5,e.GAME_STATE_GAME_WIN=6,e.EVENT_CHANGE_BG="Event_Change_Bg",e.EVENT_GAME_START="Event_Game_Start",e.EVENT_GAME_RESET="Event_Game_Reset",e.EVENT_GAME_PAUSE="Event_Game_Pause",e.EVENT_GAME_RESUME="Event_Game_Resume",e.EVENT_GAME_OVER="Event_Game_Over",e.EVENT_GAME_WAIT="Event_Game_Wait",e.EVENT_GET_CUBE="Event_Get_Cube",e.EVENT_GET_PROP="Event_Get_Prop",e.EVENT_GET_BLOCK="Event_Get_Block",e.EVENT_CLEAR_LEVEL_DATA="Event_Clear_Level_Data",e.EVENT_SHARE_LEVEL="Event_Share_Level",e.EVENT_SWITCH_RECORD="Event_Switch_Record",e.EVENT_CHANGE_DIR="Event_Change_Dir",e.EVENT_WX_AUTH="Event_WX_AUTH",e.EVENT_FIRST_CONTACT="Event_First_Contact",e.EVENT_SHOW_BLOCK_EFFECT="Event_Show_Block_Effect",e.EVENT_CROSS_HOLE="Event_Cross_Hole",e.EVENT_GET_STAR="Event_Get_Star",e.EVENT_PLAY_SFX="Event_Play_SFX",e.EVENT_TO_DESTINATION_NOT_FINISH="Event_To_Destination_not_finish",e.EVENT_NEXT_LEVEL="Event_Next_Level",e.EVENT_RESTART_LEVEL="Event_Restart_Cube",e.EVENT_COMPLETE_GAME="Event_Complete_Game",e.EVENT_SELECT_LEVEL="Event_Select_Level",e.EVENT_SHOW_DLG_UNLOCK_LEVEL="Event_Show_Dlg_Unlock_Level",e.EVENT_UNLOCK_LEVEL="Event_Unlock_Level",e.EVENT_UNLOCK_MY_LEVEL="Event_Unlock_My_Level",e.EVENT_BLOCK_CLICK="Event_Block_Click",e.ALD_EVENT_PASS_LEVEL="ald_event_pass_level",e.EVENT_CREATOR_EXPLODE_EFFECT="Event_Creator_Explode_effect",e.EVENT_REMOVE_ENEMY="Event_Remove_Enemy",e.EVENT_HIDE_RANGE="Event_Hide_Range",e.EVENT_ENEMY_ARRIVE_END="Event_Enemy_Arrive_End",e.EVENT_ENEMY_DEAD="Event_Enemy_Dead",e.GAME_MODE_NORMAL=0,e.GAME_MODE_EDIT=1,e.GAME_MODE_CUSTOM=2,e.LEVEL_GROUP_TUTORIAL=0,e.LEVEL_GROUP_EASY=1,e.LEVEL_GROUP_NORMAL=2,e.LEVEL_GROUP_HARD=3,e.LEVEL_GROUP_VERY_HADR=4,e.LEVEL_GROUP_COUNT=5,e.LEVEL_GROUP_OFFICIAL=0,e.LEVEL_GROUP_PLAYER=1,e.LEVEL_GROUP_PLAYER_COUNT=20,e}();o.GameConst=r,cc._RF.pop()},{}],GameManager:[function(e,t,o){"use strict";cc._RF.push(t,"b0c834RoFtCP6Qa0OkjW8ZQ","GameManager");var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./GameConst"),s=e("./EventMananger"),c=e("./MapConfig"),l=cc._decorator,h=l.ccclass,p=l.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.debugMapFrameLayer=null,t.levelLabel=null,t.mapLayer=null,t.frameLayer=null,t.mapOrgAndDesLayer=null,t.enemyLayer=null,t.bulletLayer=null,t.towerLayer=null,t.effectLayer=null,t.uiLayer=null,t.heartLabel=null,t.coinsLabel=null,t.waveLabel=null,t.towerUpgradePriceLabel=null,t.towerUpgradeSellPriceLabel=null,t.bottomLayer=null,t.towerBuildLayer=null,t.towerInfoLayer=null,t.towerBuildTrashLayer=null,t.waveInfoLayer=null,t.mapItemPrefab=null,t.mapItemOrgAndDesPrefab=null,t.enemyNormalPrefab=null,t.enemyFastPrefab=null,t.enemyBossPrefab=null,t.towerTurretPrefab=null,t.towerRocketPrefab=null,t.towerLaserPrefab=null,t.towerUpgradePrefab=null,t.bulletTurretPrefab=null,t.bulletRocketPrefab=null,t.effectExplodePrefab=null,t.towerRange=null,t.towerBuildRange=null,t.towerBuildCursor=null,t.mapItemOrg=null,t.mapItemDes=null,t.mapItemPool=null,t.enemyNormalPool=null,t.enemyFastPool=null,t.enemyBossPool=null,t.bulletTurretPool=null,t.bulletRocketPool=null,t.mapData=null,t.pathPosWithNextDir=new Array,t.mapItemInfoList=new Array,t.mapTowerList=new Array,t.mapTowerPosList=new Array,t.mapTowerGridList=new Array,t.curLevel=1,t.enemyIdIndex=1,t.towerIdIndex=1,t.selectTower=null,t.nextBuildTowerType=a.GameConst.TOWER.NONE,t.bottomLayoutPos=null,t.upgradeTowerBuildCount=0,t.heartCount=20,t.coinsCount=100,t.waveTotal=30,t.waveCount=0,t.waveStart=!1,t.curWaveEnemyType=0,t.curWaveEnemyHP=0,t.curWaveEnemyCoins=0,t.curWaveEnemyTotalCount=0,t.curWaveEnemyCreateCount=0,t.curWaveEnemyDestoryOrArriveCount=0,t.waveIntervalFPS=0,t.curWaveEnemyCreateFPS=60,t.curWaveFPS=0,t.gameState=a.GameConst.GAME_STATE_REPRARE,t.testCreateType=0,t.testFPS=0,t}return n(t,e),t.prototype.updateHeartCount=function(){this.heartLabel&&(this.heartLabel.string=this.heartCount+"")},t.prototype.updateCoinsCount=function(){this.coinsLabel&&(this.coinsLabel.string=this.coinsCount+""),this.updateBuildTowerInfo()},t.prototype.updateWaveCount=function(){this.waveLabel&&(this.waveLabel.string=this.waveCount+"/"+this.waveTotal)},t.prototype.updatetowerUpgradePrice=function(){this.towerUpgradePriceLabel&&(this.towerUpgradePriceLabel.string=a.GameConst.TOWER_BUILD_COST.UPGRADE+10*this.upgradeTowerBuildCount+"")},t.prototype.setTowerSellPrice=function(e){this.towerUpgradeSellPriceLabel&&(this.towerUpgradeSellPriceLabel.string=e+"")},t.prototype.updateBuildTowerInfo=function(){var e=this.towerBuildLayer.getChildByName("TowerBuildTurret").getChildByName("TowerSprite"),t=this.towerBuildLayer.getChildByName("TowerBuildRocket").getChildByName("TowerSprite"),o=this.towerBuildLayer.getChildByName("TowerBuildLaser").getChildByName("TowerSprite"),r=this.towerBuildLayer.getChildByName("TowerBuildUpgrade").getChildByName("TowerSprite");this.coinsCount>=a.GameConst.TOWER_BUILD_COST.TURRET?e.opacity=255:e.opacity=125,this.coinsCount>=a.GameConst.TOWER_BUILD_COST.ROCKET?t.opacity=255:t.opacity=125,this.coinsCount>=a.GameConst.TOWER_BUILD_COST.LASER?o.opacity=255:o.opacity=125,this.coinsCount>=a.GameConst.TOWER_BUILD_COST.UPGRADE+10*this.upgradeTowerBuildCount?r.opacity=255:r.opacity=125},t.prototype.onEnable=function(){s.EventMananger.getInstance().addEvent(a.GameConst.EVENT_CREATOR_EXPLODE_EFFECT,this.createExplodeEffect,this),s.EventMananger.getInstance().addEvent(a.GameConst.EVENT_ENEMY_ARRIVE_END,this.enemyArriveEnd,this),s.EventMananger.getInstance().addEvent(a.GameConst.EVENT_ENEMY_DEAD,this.enemyDead,this)},t.prototype.onDisable=function(){s.EventMananger.getInstance().removeEvent(a.GameConst.EVENT_CREATOR_EXPLODE_EFFECT,this.createExplodeEffect,this),s.EventMananger.getInstance().removeEvent(a.GameConst.EVENT_ENEMY_ARRIVE_END,this.enemyArriveEnd,this),s.EventMananger.getInstance().removeEvent(a.GameConst.EVENT_ENEMY_DEAD,this.enemyDead,this)},t.prototype.enemyDead=function(e){this.curWaveEnemyDestoryOrArriveCount++,cc.log("EnemyDead:curWaveEnemyDestoryOrArriveCount="+this.curWaveEnemyDestoryOrArriveCount),this.checkWaveFinsh(),this.coinsCount+=e,this.updateCoinsCount()},t.prototype.enemyArriveEnd=function(){this.curWaveEnemyDestoryOrArriveCount++,cc.log("EnemyArriveEnd:curWaveEnemyDestoryOrArriveCount="+this.curWaveEnemyDestoryOrArriveCount),this.heartCount--,this.updateHeartCount(),this.checkGameOver()&&(this.gameState=a.GameConst.GAME_STATE_GAME_OVER),this.checkWaveFinsh()},t.prototype.checkGameOver=function(){return this.heartCount<=0},t.prototype.checkWaveFinsh=function(){return cc.log("checkWaveFinsh!!"),this.gameState!=a.GameConst.GAME_STATE_GAME_OVER&&this.curWaveEnemyCreateCount>=this.curWaveEnemyTotalCount&&this.curWaveEnemyDestoryOrArriveCount>=this.curWaveEnemyTotalCount&&(cc.log("checkWaveFinsh!!  FINISH!"),this.waveStart=!1,this.curWaveEnemyTotalCount=0,this.curWaveEnemyDestoryOrArriveCount=0,this.curWaveEnemyCreateCount=0,!0)},t.prototype.onLoad=function(){this.initMapItemPool(),this.loadMap(),this.initEnemyPool(),this.initBulletPool()},t.prototype.start=function(){cc.director.getCollisionManager().enabled=!0},t.prototype.initBulletPool=function(){if(null==this.bulletTurretPool){this.bulletTurretPool=new cc.NodePool("BulletTurret");for(var e=0;e<50;e++)this.bulletTurretPool.put(cc.instantiate(this.bulletTurretPrefab))}if(null==this.bulletRocketPool)for(this.bulletRocketPool=new cc.NodePool("BulletRocket"),e=0;e<20;e++)this.bulletRocketPool.put(cc.instantiate(this.bulletRocketPrefab))},t.prototype.createOneBulletTurret=function(e){if(null!=e&&null!=e&&this.bulletTurretPool){var t=null,o=e.node.getPosition(),r=e.getDamage(),n=e.getTargetEnemy();if(null==n||null==n)return;this.bulletTurretPool.size()>0?t=this.bulletTurretPool.get(this.bulletTurretPool,r,n,o):(t=cc.instantiate(this.bulletTurretPrefab)).getComponent("BulletTurret").init(r,n,o),t.zIndex=2,t.parent=this.bulletLayer}},t.prototype.createOneBulletRocket=function(e){if(null!=e&&null!=e&&this.bulletRocketPool){var t=null,o=e.node.getPosition(),r=e.getDamage(),n=e.getTargetEnemy();if(null==n||null==n)return;this.bulletRocketPool.size()>0?t=this.bulletRocketPool.get(this.bulletRocketPool,r,n,o):(t=cc.instantiate(this.bulletRocketPrefab)).getComponent("BulletRocket").init(r,n,o),t.zIndex=2,t.parent=this.bulletLayer}},t.prototype.createExplodeEffect=function(e,t){if(this.effectLayer){var o=cc.instantiate(this.effectExplodePrefab);if(o){o.parent=this.effectLayer;var r=o.getComponent("ExplodeEffect");r&&r.setDamage(t),o.setPosition(e)}}},t.prototype.initEnemyPool=function(){null==this.enemyNormalPool&&(this.enemyNormalPool=new cc.NodePool("Enemy")),null==this.enemyFastPool&&(this.enemyFastPool=new cc.NodePool("Enemy")),null==this.enemyBossPool&&(this.enemyBossPool=new cc.NodePool("Enemy"))},t.prototype.createOneEnemyNormal=function(e,t,o,r,n){if(this.enemyNormalPool){var i=null;this.enemyNormalPool.size()>0?i=this.enemyNormalPool.get(this.enemyNormalPool,e,t,o,r,n,this.enemyIdIndex):(i=cc.instantiate(this.enemyNormalPrefab)).getComponent("Enemy").init(e,t,o,r,n,this.enemyIdIndex),i.parent=this.enemyLayer,this.enemyIdIndex++}},t.prototype.createOneEnemyFase=function(e,t,o,r,n){if(this.enemyFastPool){var i=null;this.enemyFastPool.size()>0?i=this.enemyFastPool.get(this.enemyFastPool,e,t,o,r,n,this.enemyIdIndex):(i=cc.instantiate(this.enemyFastPrefab)).getComponent("Enemy").init(e,t,o,r,n,this.enemyIdIndex),i.parent=this.enemyLayer,this.enemyIdIndex++}},t.prototype.createOneEnemyBoss=function(e,t,o,r,n){if(this.enemyBossPool){var i=null;this.enemyBossPool.size()>0?i=this.enemyBossPool.get(this.enemyBossPool,e,t,o,r,n,this.enemyIdIndex):(i=cc.instantiate(this.enemyBossPrefab)).getComponent("Enemy").init(e,t,o,r,n,this.enemyIdIndex),i.parent=this.enemyLayer,this.enemyIdIndex++}},t.prototype.initMapItemPool=function(){this.mapItemPool=new cc.NodePool;for(var e=0;e<60;++e){var t=cc.instantiate(this.mapItemPrefab);this.mapItemPool.put(t)}},t.prototype.createMapItem=function(e){var t=null;(t=this.mapItemPool.size()>0?this.mapItemPool.get():cc.instantiate(this.mapItemPrefab)).parent=this.mapLayer,t.setPosition(e),t.getComponent("MapItem").init(a.GameConst.MAP_SIZE)},t.prototype.createMapItemOrgAndDes=function(e,t,o){switch(e){case a.GameConst.MAP_ITEM_TYPE.ORIGIN:this.mapItemOrg||(this.mapItemOrg=cc.instantiate(this.mapItemOrgAndDesPrefab)),this.mapItemOrg.parent=this.mapOrgAndDesLayer,this.mapItemOrg.zIndex=2,this.mapItemOrg.getComponent("MapOrgAndDes").init(e,t,o);break;case a.GameConst.MAP_ITEM_TYPE.DESTINATION:this.mapItemDes||(this.mapItemDes=cc.instantiate(this.mapItemOrgAndDesPrefab)),this.mapItemDes.parent=this.mapOrgAndDesLayer,this.mapItemDes.zIndex=2,this.mapItemDes.getComponent("MapOrgAndDes").init(e,t,o)}},t.prototype.clearMap=function(){if(this.mapLayer){var e=this.mapLayer.children;if(e)for(var t=e.length,o=0;o<t;o++){var r=e[o];this.mapItemPool.put(r)}}this.mapOrgAndDesLayer&&this.mapOrgAndDesLayer.removeAllChildren()},t.prototype.setLevelLabel=function(e){this.levelLabel&&(this.levelLabel.string="Level "+e)},t.prototype.setSelectTower=function(e){if(this.selectTower=e,this.selectTower){var t=this.selectTower.node.getPosition(),o=this.selectTower.getRange();cc.log("setSelectTower:size="+o.width+","+o.height),this.showTowerRange(t,o,!0),this.showTowerInfoLayout(!0)}else this.showTowerRange(cc.v2(0,0),null,!1),this.showTowerInfoLayout(!1)},t.prototype.showTowerRange=function(e,t,o){this.towerRange&&(this.towerRange.active=o,t&&(cc.log("showTowerRange:range="+t.width+","+t.height),this.towerRange.width=t.width,this.towerRange.height=t.height),this.towerRange.setPosition(e))},t.prototype.calMapGridStartPos=function(){var e=cc.winSize.height/2,t=cc.winSize.width/2;if(this.leftTopMapItemPos){console.log("leftTopMapItemPos :",this.leftTopMapItemPos.x+","+this.leftTopMapItemPos.y);for(var o=this.leftTopMapItemPos.x-a.GameConst.MAP_SIZE/2,r=this.leftTopMapItemPos.y+a.GameConst.MAP_SIZE/2,n=o;n>-t;)n-=a.GameConst.MAP_SIZE;for(var i=o;i<t;)i+=a.GameConst.MAP_SIZE;for(var s=r;s>-e;)s-=a.GameConst.MAP_SIZE;for(var l=r;l<e;)l+=a.GameConst.MAP_SIZE;this.mapStartPos=new cc.Vec3(n+a.GameConst.MAP_SIZE/2,l-a.GameConst.MAP_SIZE/2,0),cc.log("\u8d77\u70b9\u5750\u6807\uff1a"+this.mapStartPos.x+","+this.mapStartPos.y);var h=new cc.Vec3(i-a.GameConst.MAP_SIZE/2,s+a.GameConst.MAP_SIZE/2,0);cc.log("\u7ec8\u70b9\u5750\u6807\uff1a"+h.x+","+h.y);var p=this.getMapGird(this.mapStartPos);cc.log("\u8d77\u70b9Gird:"+p.x+","+p.y);var u=this.getMapGird(h);if(cc.log("\u7ec8\u70b9Gird:"+u.x+","+u.y),this.mapTowerPosList){var E=this.mapTowerPosList.length;cc.log("\u5f53\u524d\u5730\u56fe\u53ef\u4ee5\u5efa\u9020\u5854\u6570\uff1a"+E);for(var _=0;_<E;_++){var d=this.mapTowerPosList[_];if(d){var m=this.getMapGird(d);this.mapTowerGridList.push(m);var T=new c.MapItemInfo;T.type=0,T.state=0,T.pos=d,null!=this.mapItemInfoList[m.x]&&null!=this.mapItemInfoList[m.x]||(this.mapItemInfoList[m.x]=new Array),this.mapItemInfoList[m.x][m.y]=T}}}cc.log("===================:"),cc.log("mapItemInfoList:"),cc.log(this.mapItemInfoList),cc.log("===================:")}},t.prototype.checkCanBuildTower=function(e){if(e&&this.mapItemInfoList){var t=e.x,o=e.y;if(null!=this.mapItemInfoList[t]&&null!=this.mapItemInfoList[t]){var r=this.mapItemInfoList[t][o];if(r){var n=r.state;if(r.type>=0&&0==n)return!0}}}return!1},t.prototype.buildTower=function(e,t){var o=0;switch(e){case a.GameConst.TOWER.TURRET:o=a.GameConst.TOWER_BUILD_COST.TURRET;break;case a.GameConst.TOWER.ROCKET:o=a.GameConst.TOWER_BUILD_COST.ROCKET;break;case a.GameConst.TOWER.LASER:o=a.GameConst.TOWER_BUILD_COST.LASER;break;case a.GameConst.TOWER.UPGRADE:o=a.GameConst.TOWER_BUILD_COST.UPGRADE+10*this.upgradeTowerBuildCount}if(this.coinsCount>=o&&(this.coinsCount-=o,this.updateCoinsCount(),t&&this.mapItemInfoList&&e>a.GameConst.TOWER.NONE)){var r=t.x,n=t.y;if(null!=this.mapItemInfoList[r]&&null!=this.mapItemInfoList[r]){var i=this.mapItemInfoList[r][n];if(i){var s=i.state;if(i.type>=0&&0==s){var c=i.pos;i.type=e,i.state=1;var l=this.createTower(e,c);null!=this.mapTowerList[r]&&null!=this.mapTowerList[r]||(this.mapTowerList[r]=new Array),this.mapTowerList[r][n]=l,e==a.GameConst.TOWER.UPGRADE?(this.upgradeTowerByCenter(l,t),this.upgradeTowerBuildCount++,this.updatetowerUpgradePrice()):this.updateTowerUpgradeUIByCenter(l,t),this.gameState==a.GameConst.GAME_STATE_WAIT_START&&(this.gameState=a.GameConst.GAME_STATE_START,cc.log("\u5efa\u9020\u7b2c\u4e00\u4e2a\u70ae\u5854\uff0c\u6e38\u620f\u5f00\u59cb\uff01\uff01\uff01\uff01"))}}}}},t.prototype.upgradeTower=function(e,t){if(e<0||t<0)return!1;if(this.mapTowerList[e]&&this.mapItemInfoList[e]){var o=this.mapTowerList[e][t];if(o){var r=this.mapItemInfoList[e][t].type;if(r>a.GameConst.TOWER.NONE&&r!=a.GameConst.TOWER.UPGRADE)return o.getComponent("Tower").upgrade(),!0}}return!1},t.prototype.degradeTower=function(e,t){if(e<0||t<0)return!1;if(this.mapTowerList[e]&&this.mapItemInfoList[e]){var o=this.mapTowerList[e][t];if(o){var r=this.mapItemInfoList[e][t].type;if(r>a.GameConst.TOWER.NONE&&r!=a.GameConst.TOWER.UPGRADE)return o.getComponent("Tower").degrade(),!0}}return!1},t.prototype.getUpgradeTower=function(e,t){if(e<0||t<0)return null;if(this.mapTowerList[e]&&this.mapItemInfoList[e]){var o=this.mapTowerList[e][t];if(o&&this.mapItemInfoList[e][t].type==a.GameConst.TOWER.UPGRADE)return o}return null},t.prototype.updateTowerUpgradeUIByCenter=function(e,t){if(null!=e&&null!=e){var o=e.getComponent("Tower");if(null!=o&&null!=o){var r=1,n=t.x,i=t.y,s=n,c=i-1,l=this.getUpgradeTower(s,c);l&&(l.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.BOTTOM,!0,!0),r++);var h=n,p=i+1,u=this.getUpgradeTower(h,p);u&&(u.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.TOP,!0,!0),r++);var E=n-1,_=i,d=this.getUpgradeTower(E,_);d&&(d.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.RIGHT,!0,!0),r++);var m=n+1,T=i,y=this.getUpgradeTower(m,T);y&&(y.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.LEFT,!0,!0),r++);var f=n-1,g=i-1,v=this.getUpgradeTower(f,g);v&&(v.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.RIGHT_BOTTOM,!0,!0),r++);var C=n-1,R=i+1,A=this.getUpgradeTower(C,R);A&&(A.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.RIGHT_TOP,!0,!0),r++);var L=n+1,O=i-1,P=this.getUpgradeTower(L,O);P&&(P.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.LEFT_BOTTOM,!0,!0),r++);var w=n+1,G=i+1,I=this.getUpgradeTower(w,G);I&&(I.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.LEFT_TOP,!0,!0),r++),o.setLevel(r),o.updateLevelLabel()}}},t.prototype.updateTowerUpgradeUIBySellTower=function(e,t){if(null!=e&&null!=e){var o=e.getComponent("Tower");if(null!=o&&null!=o){var r=t.x,n=t.y,i=r,s=n-1,c=this.getUpgradeTower(i,s);c&&c.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.BOTTOM,!1,!0);var l=r,h=n+1,p=this.getUpgradeTower(l,h);p&&p.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.TOP,!1,!0);var u=r-1,E=n,_=this.getUpgradeTower(u,E);_&&_.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.RIGHT,!1,!0);var d=r+1,m=n,T=this.getUpgradeTower(d,m);T&&T.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.LEFT,!1,!0);var y=r-1,f=n-1,g=this.getUpgradeTower(y,f);g&&g.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.RIGHT_BOTTOM,!1,!0);var v=r-1,C=n+1,R=this.getUpgradeTower(v,C);R&&R.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.RIGHT_TOP,!1,!0);var A=r+1,L=n-1,O=this.getUpgradeTower(A,L);O&&O.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.LEFT_BOTTOM,!1,!0);var P=r+1,w=n+1,G=this.getUpgradeTower(P,w);G&&G.getComponent("Tower").setUpgradeTowerDir(a.GameConst.TOWER_DIR.LEFT_TOP,!1,!0)}}},t.prototype.upgradeTowerByCenter=function(e,t){if(null!=e&&null!=e){var o=e.getComponent("Tower");if(null!=o&&null!=o){var r=t.x,n=t.y,i=r,s=n-1,c=this.upgradeTower(i,s);o.setUpgradeTowerDir(a.GameConst.TOWER_DIR.TOP,c,!1);var l=r,h=n+1,p=this.upgradeTower(l,h);o.setUpgradeTowerDir(a.GameConst.TOWER_DIR.BOTTOM,p,!1);var u=r-1,E=n,_=this.upgradeTower(u,E);o.setUpgradeTowerDir(a.GameConst.TOWER_DIR.LEFT,_,!1);var d=r+1,m=n,T=this.upgradeTower(d,m);o.setUpgradeTowerDir(a.GameConst.TOWER_DIR.RIGHT,T,!1);var y=r-1,f=n-1,g=this.upgradeTower(y,f);o.setUpgradeTowerDir(a.GameConst.TOWER_DIR.LEFT_TOP,g,!1);var v=r-1,C=n+1,R=this.upgradeTower(v,C);o.setUpgradeTowerDir(a.GameConst.TOWER_DIR.LEFT_BOTTOM,R,!1);var A=r+1,L=n-1,O=this.upgradeTower(A,L);o.setUpgradeTowerDir(a.GameConst.TOWER_DIR.RIGHT_TOP,O,!1);var P=r+1,w=n+1,G=this.upgradeTower(P,w);o.setUpgradeTowerDir(a.GameConst.TOWER_DIR.RIGHT_BOTTOM,G,!1),o.updateUpgradeTowerUI()}}},t.prototype.degradedTowerByCenter=function(e){var t=e.x,o=e.y,r=t,n=o-1;this.degradeTower(r,n);var i=t,a=o+1;this.degradeTower(i,a);var s=t-1,c=o;this.degradeTower(s,c);var l=t+1,h=o;this.degradeTower(l,h);var p=t-1,u=o-1;this.degradeTower(p,u);var E=t-1,_=o+1;this.degradeTower(E,_);var d=t+1,m=o-1;this.degradeTower(d,m);var T=t+1,y=o+1;this.degradeTower(T,y)},t.prototype.showDebugMapFrameLayer=function(){if(this.debugMapFrameLayer){var e=this.debugMapFrameLayer.getComponent(cc.Graphics),t=(a.GameConst.MAP_MARGIN_BOTTOM,cc.winSize.height/2),o=cc.winSize.width/2;if(this.leftTopMapItemPos){for(var r=this.leftTopMapItemPos.x-a.GameConst.MAP_SIZE/2,n=this.leftTopMapItemPos.y+a.GameConst.MAP_SIZE/2,i=r;i>-o;)e.moveTo(i,t),e.lineTo(i,-t),i-=a.GameConst.MAP_SIZE;for(var s=r;s<o;)e.moveTo(s,t),e.lineTo(s,-t),s+=a.GameConst.MAP_SIZE;for(var c=n;c>-t;)e.moveTo(-o,c),e.lineTo(o,c),c-=a.GameConst.MAP_SIZE;for(var l=n;l<t;)e.moveTo(-o,l),e.lineTo(o,l),l+=a.GameConst.MAP_SIZE;e.stroke()}}},t.prototype.getMapGird=function(e){var t=Math.floor((e.x-this.mapStartPos.x+a.GameConst.MAP_SIZE/2)/a.GameConst.MAP_SIZE),o=Math.floor((-e.y+this.mapStartPos.y+a.GameConst.MAP_SIZE/2)/a.GameConst.MAP_SIZE);return cc.v2(t,o)},t.prototype.getMapPos=function(e){var t=e.x,o=e.y;return cc.v3(this.mapStartPos.x+t*a.GameConst.MAP_SIZE,this.mapStartPos.y-o*a.GameConst.MAP_SIZE,0)},t.prototype.setFrameLayer=function(e,t){if(e>0&&t>0){var o=t*a.GameConst.MAP_SIZE+10,r=e*a.GameConst.MAP_SIZE+10,n=a.GameConst.MAP_MARGIN_BOTTOM/2;if(this.frameLayer){this.frameLayer.width=o,this.frameLayer.height=r,this.frameLayer.y=n;var i=this.frameLayer.getChildByName("FrameSprite");i&&(i.width=o,i.height=r,i.y=n)}}},t.prototype.checkShowFrame=function(e){if(this.frameLayer&&e){var t=a.GameConst.MAP_MARGIN_BOTTOM/2,o=-this.frameLayer.width/2,r=this.frameLayer.width/2,n=this.frameLayer.y+this.frameLayer.height/2+t,i=this.frameLayer.y-this.frameLayer.height/2+t;if(e.x<=o||e.x>=r||e.y<=i||e.y>=n)return!0}return!1},t.prototype.showFrame=function(e){if(this.frameLayer)if(e&&0==this.frameLayer.opacity){var t=a.GameConst.MAP_MARGIN_BOTTOM/2;this.frameLayer.opacity=255,this.frameLayer.y=t,this.frameLayer.stopAllActions(),cc.tween(this.frameLayer).delay(.8).to(.2,{opacity:0}).start()}else this.frameLayer.opacity=0},t.prototype.createTower=function(e,t){cc.log("######createTower:type="+e+",pos="+t.x+","+t.y);var o=null;switch(e){case a.GameConst.TOWER.TURRET:o=cc.instantiate(this.towerTurretPrefab);break;case a.GameConst.TOWER.ROCKET:o=cc.instantiate(this.towerRocketPrefab);break;case a.GameConst.TOWER.LASER:o=cc.instantiate(this.towerLaserPrefab);break;case a.GameConst.TOWER.UPGRADE:o=cc.instantiate(this.towerUpgradePrefab)}return o&&(o.parent=this.towerLayer,o.getComponent("Tower").init(e,this,this.towerIdIndex),o.setPosition(t),this.towerIdIndex++),o},t.prototype.resetMap=function(){if(this.enemyIdIndex=1,this.mapLayer&&this.mapLayer.removeAllChildren(),this.mapOrgAndDesLayer&&this.mapOrgAndDesLayer.removeAllChildren(),this.towerLayer&&this.towerLayer.removeAllChildren(),this.bulletLayer&&this.bulletLayer.removeAllChildren(),this.effectLayer&&this.effectLayer.removeAllChildren(),this.mapTowerList&&(this.mapTowerList.length=0),this.enemyLayer){var e=this.enemyLayer.children;if(e)for(var t=e.length,o=0;o<t;o++){var r=e[o];if(r){var n=r.getComponent("Enemy");n&&n.remove()}}this.enemyLayer.removeAllChildren()}if(this.mapTowerPosList.length=0,this.mapTowerGridList.length=0,this.leftTopMapItemPos=cc.v3(0,0,0),this.rightBottomMapItemPos=cc.v3(0,0,0),this.curWaveEnemyDestoryOrArriveCount=0,this.upgradeTowerBuildCount=0,this.waveStart=!1,this.gameState=a.GameConst.GAME_STATE_REPRARE,this.mapItemInfoList){for(var i=0,s=this.mapItemInfoList;i<s.length;i++){var c=s[i];c&&(c.length=0)}this.mapItemInfoList.length=0}this.showTowerInfoLayout(!1),this.updatetowerUpgradePrice()},t.prototype.loadMap=function(){this.enemyIdIndex=1;var e=this.curLevel;this.setLevelLabel(e);var t="map/"+e,o=this;cc.resources.load(t,function(e,r){cc.log("======\u52a0\u8f7d\u5730\u56fe======"),cc.log("\u52a0\u8f7d\u5730\u56fe\uff1a mapPath:"+t),e?cc.log(e):(cc.log("Map:"+JSON.stringify(r)),o.initMap(r.text),o.calMapGridStartPos(),o.heartCount=20,o.updateHeartCount(),o.coinsCount=100,o.updateCoinsCount(),o.waveTotal=20,o.waveCount=0,o.updateWaveCount(),o.updatetowerUpgradePrice(),o.gameState=a.GameConst.GAME_STATE_WAIT_START),cc.log("======\u52a0\u8f7d\u5730\u56fe======")})},t.prototype.initMap=function(e){if(e){this.mapData=e,cc.log("\u751f\u6210\u5730\u56fe mapData:"+this.mapData);var t=JSON.parse(e);if(t){cc.log("\u5730\u56fe\u914d\u7f6e field:"),cc.log(t.field),cc.log("\u5730\u56fe\u914d\u7f6e path1:"),cc.log(t.path1),this.path=t.path1;var o=new Array,r=new Array,n=t.field.length,i=t.field[0].cells.length,s=Math.floor(n/2),l=Math.floor(i/2);this.setFrameLayer(n,i),cc.log("\u5730\u56fe\u914d\u7f6e halfRow:"+s),cc.log("\u5730\u56fe\u914d\u7f6e halfCol:"+l);for(var h=0;h<n;h++)for(var p=0;p<i;p++){var u=t.field[h].cells[p];if(0==h&&0==p){var E=(p-l)*a.GameConst.MAP_SIZE,_=(s-h)*a.GameConst.MAP_SIZE+a.GameConst.MAP_MARGIN_BOTTOM,d=cc.v3(E,_,0);this.leftTopMapItemPos=d}else h==n-1&&p==i-1&&(E=(p-l)*a.GameConst.MAP_SIZE,_=(s-h)*a.GameConst.MAP_SIZE+a.GameConst.MAP_MARGIN_BOTTOM,d=cc.v3(E,_,0),this.rightBottomMapItemPos=d);if(u>0){if(E=(p-l)*a.GameConst.MAP_SIZE,_=(s-h)*a.GameConst.MAP_SIZE+a.GameConst.MAP_MARGIN_BOTTOM,d=cc.v3(E,_,0),this.createMapItem(d),r[p+h*i]=d,10==u){var m=-1;(y=h-1)>=0&&t.field[y].cells[p]>0&&(m=a.GameConst.DIR.TOP),m<0&&(f=h+1)<n&&t.field[f].cells[p]>0&&(m=a.GameConst.DIR.BOTTOM),m<0&&(g=p-1)>0&&t.field[h].cells[g]>0&&(m=a.GameConst.DIR.LEFT),m<0&&(v=p+1)<i&&t.field[h].cells[v]>0&&(m=a.GameConst.DIR.RIGHT);var T=cc.v3(E,_,0);switch(m){case a.GameConst.DIR.TOP:T.y-=Math.floor(a.GameConst.MAP_SIZE/2);break;case a.GameConst.DIR.BOTTOM:T.y+=Math.floor(a.GameConst.MAP_SIZE/2);break;case a.GameConst.DIR.LEFT:T.x+=Math.floor(a.GameConst.MAP_SIZE/2);break;case a.GameConst.DIR.RIGHT:T.x-=Math.floor(a.GameConst.MAP_SIZE/2)}this.startPos=T,this.startDir=m,this.createMapItemOrgAndDes(a.GameConst.MAP_ITEM_TYPE.ORIGIN,m,d)}else if(20==u){var y,f,g,v;m=-1,(y=h-1)>=0&&t.field[y].cells[p]>0&&(m=a.GameConst.DIR.TOP),m<0&&(f=h+1)<n&&t.field[f].cells[p]>0&&(m=a.GameConst.DIR.BOTTOM),m<0&&(g=p-1)>0&&t.field[h].cells[g]>0&&(m=a.GameConst.DIR.LEFT),m<0&&(v=p+1)<i&&t.field[h].cells[v]>0&&(m=a.GameConst.DIR.RIGHT),this.createMapItemOrgAndDes(a.GameConst.MAP_ITEM_TYPE.DESTINATION,m,d)}}else 0==u&&(E=(p-l)*a.GameConst.MAP_SIZE,_=(s-h)*a.GameConst.MAP_SIZE+a.GameConst.MAP_MARGIN_BOTTOM,d=cc.v3(E,_,0),this.mapTowerPosList.push(d))}if(r)for(var C=this.path.length,R=0;R<C;R++){var A=this.path[R];d=r[(E=A.x)*i+(_=A.y)],o.push(d)}if(this.pathPosWithNextDir&&(this.pathPosWithNextDir.length=0),o)for(C=o.length,h=0;h<C;h++){d=o[h];var L=new c.PathPosWithNextDir;if(L.pos=d,h<C-1){var O=o[h+1],P=this.getNextDir(d,O);L.nextDir=P}else L.nextDir=-1;this.pathPosWithNextDir.push(L)}}}this.mapLayer&&(this.mapLayer.on(cc.Node.EventType.TOUCH_START,this.onTouch,this),this.mapLayer.on(cc.Node.EventType.TOUCH_MOVE,this.onTouch,this),this.mapLayer.on(cc.Node.EventType.TOUCH_END,this.onTouch,this),this.mapLayer.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouch,this))},t.prototype.setNextBuildTower=function(e){if(this.nextBuildTowerType=e,e<=a.GameConst.TOWER.NONE)return this.towerBuildRange&&(this.towerBuildRange.active=!1),void(this.towerBuildCursor&&(this.towerBuildCursor.active=!1));var t=null;switch(e){case a.GameConst.TOWER.TURRET:t=cc.size(279,279);break;case a.GameConst.TOWER.ROCKET:t=cc.size(465,465);break;case a.GameConst.TOWER.LASER:t=cc.size(651,651);break;case a.GameConst.TOWER.UPGRADE:}if(this.towerBuildRange){this.towerBuildRange.active=!0;var o=this.towerBuildRange.getChildByName("range");o&&(t?(this.towerBuildRange.width=t.width,this.towerBuildRange.height=t.height,o.active=!0,o.width=t.width,o.height=t.height):o.active=!1)}this.towerBuildCursor&&(this.towerBuildCursor.active=!0)},t.prototype.updateBuildTowerCursorPos=function(e){if(null!=this.bottomLayoutPos&&null!=this.bottomLayoutPos||(this.bottomLayoutPos=this.bottomLayer.getPosition()),this.towerBuildCursor){if(e.y+a.GameConst.MAP_SIZE<this.bottomLayoutPos.y)return this.towerBuildRange&&(this.towerBuildRange.active=!1),void(this.towerBuildCursor&&(this.towerBuildCursor.active=!1));this.towerBuildRange&&(this.towerBuildRange.active=!0),this.towerBuildCursor&&(this.towerBuildCursor.active=!0);var t=cc.v3(e.x,e.y+2*a.GameConst.MAP_SIZE,0);if(this.towerBuildRange){this.towerBuildRange.active&&this.towerBuildRange.setPosition(t);var o=this.getMapGird(t);if(this.towerBuildCursor){var r=this.getMapPos(o);this.towerBuildCursor.setPosition(r),this.checkCanBuildTower(o)?this.towerBuildCursor.color=cc.Color.GREEN:this.towerBuildCursor.color=cc.Color.RED}}}},t.prototype.showTowerInfoLayout=function(e){this.towerInfoLayer&&this.towerBuildLayer&&(e?(this.towerInfoLayer.active=!0,this.towerBuildLayer.active=!1,this.updateTowerInfo()):(this.towerInfoLayer.active=!1,this.towerBuildLayer.active=!0))},t.prototype.updateTowerInfo=function(){if(this.selectTower&&this.towerInfoLayer){var e=this.selectTower.getType(),t=this.selectTower.getDamage(),o=this.selectTower.getSellPrice(),r=this.selectTower.getCD(),n=this.towerInfoLayer.getChildByName("TowerDamage"),i=this.towerInfoLayer.getChildByName("TowerPrice"),s=this.towerInfoLayer.getChildByName("TowerCD");if(n){var c=n.getChildByName("LabelDamage").getComponent(cc.Label);c&&(c.string=t+"")}if(i){var l=i.getChildByName("LabelPrice").getComponent(cc.Label);l&&(e==a.GameConst.TOWER.UPGRADE&&(o=a.GameConst.TOWER_SELL_PRICE.UPGRADE+10*Math.floor(this.upgradeTowerBuildCount/2)),l.string=o+"")}if(s){var h=s.getChildByName("LabelCD").getComponent(cc.Label);h&&(h.string=r+"")}}},t.prototype.switchToTrashLayout=function(e){var t=this;if(null!=this.bottomLayoutPos&&null!=this.bottomLayoutPos||(this.bottomLayoutPos=this.bottomLayer.getPosition()),e){if(this.bottomLayer){this.bottomLayer.stopAllActions(),this.bottomLayer.setPosition(this.bottomLayoutPos);var o=cc.v3(this.bottomLayoutPos.x,this.bottomLayoutPos.y-300,0);cc.tween(this.bottomLayer).to(.1,{position:o}).call(function(){}).start()}if(this.towerBuildTrashLayer){this.towerBuildTrashLayer.stopAllActions();var r=cc.v3(this.bottomLayoutPos.x,this.bottomLayoutPos.y-300,0);this.towerBuildTrashLayer.setPosition(r),this.towerBuildTrashLayer.active=!0,o=cc.v3(this.bottomLayoutPos.x,this.bottomLayoutPos.y,0),cc.tween(this.towerBuildTrashLayer).to(.2,{position:o}).call(function(){}).start()}}else this.towerBuildTrashLayer&&(this.towerBuildTrashLayer.stopAllActions(),this.towerBuildTrashLayer.setPosition(this.bottomLayoutPos),o=cc.v3(this.bottomLayoutPos.x,this.bottomLayoutPos.y-300,0),this.towerBuildTrashLayer.active=!0,cc.tween(this.towerBuildTrashLayer).to(.1,{position:o}).call(function(){t.towerBuildTrashLayer.active=!1}).start()),this.bottomLayer&&(this.bottomLayer.stopAllActions(),r=cc.v3(this.bottomLayoutPos.x,this.bottomLayoutPos.y-300,0),this.bottomLayer.setPosition(r),o=cc.v3(this.bottomLayoutPos.x,this.bottomLayoutPos.y,0),cc.tween(this.bottomLayer).to(.2,{position:o}).call(function(){}).start())},t.prototype.onTouch=function(e){var t=e.getLocation(),o=this.mapLayer.convertToNodeSpaceAR(t),r=this.towerBuildLayer.convertToNodeSpaceAR(t);if(e.type==cc.Node.EventType.TOUCH_START){if(this.gameState!=a.GameConst.GAME_STATE_WAIT_START&&this.gameState!=a.GameConst.GAME_STATE_START)return;if(console.log("TOUCH_START towerBuildPos=["+r.x+","+r.y+"]"),Math.abs(r.y)<=60&&this.towerBuildLayer.active){var n=a.GameConst.TOWER.NONE;r.x>=0&&r.x<=120?(console.log("TOUCH_START towerTurret!!!"),this.coinsCount>=a.GameConst.TOWER_BUILD_COST.TURRET&&(n=a.GameConst.TOWER.TURRET)):r.x>=200&&r.x<=320?(console.log("TOUCH_START towerRocket!!!"),this.coinsCount>=a.GameConst.TOWER_BUILD_COST.ROCKET&&(n=a.GameConst.TOWER.ROCKET)):r.x>=400&&r.x<=520?(console.log("TOUCH_START towerLaser!!!"),this.coinsCount>=a.GameConst.TOWER_BUILD_COST.LASER&&(n=a.GameConst.TOWER.LASER)):r.x>=600&&r.x<=720&&(console.log("TOUCH_START towerUpgrade!!!"),this.coinsCount>=a.GameConst.TOWER_BUILD_COST.UPGRADE+10*this.upgradeTowerBuildCount&&(n=a.GameConst.TOWER.UPGRADE)),n>=a.GameConst.TOWER.NONE&&(this.setNextBuildTower(n),n>a.GameConst.TOWER.NONE&&(this.updateBuildTowerCursorPos(o),this.switchToTrashLayout(!0)))}this.setSelectTower(null)}else if(e.type==cc.Node.EventType.TOUCH_MOVE)this.nextBuildTowerType>a.GameConst.TOWER.NONE&&this.updateBuildTowerCursorPos(o);else if(e.type==cc.Node.EventType.TOUCH_END||e.type==cc.Node.EventType.TOUCH_CANCEL){if(this.nextBuildTowerType>a.GameConst.TOWER.NONE){var i=this.towerBuildCursor.getPosition(),s=this.getMapGird(cc.v3(i.x,i.y,0));this.checkCanBuildTower(s)&&this.buildTower(this.nextBuildTowerType,s),this.switchToTrashLayout(!1)}this.setNextBuildTower(a.GameConst.TOWER.NONE),this.checkShowFrame(o)&&this.showFrame(!0),this.getMapGird(this.leftTopMapItemPos),this.getMapGird(this.rightBottomMapItemPos)}},t.prototype.getNextDir=function(e,t){var o=-1;return t.x>e.x?o=a.GameConst.DIR.RIGHT:t.x<e.x?o=a.GameConst.DIR.LEFT:t.y>e.y?o=a.GameConst.DIR.TOP:t.y<e.y&&(o=a.GameConst.DIR.BOTTOM),o},t.prototype.showMapArrow=function(){if(this.mapItemOrg){var e=this.mapItemOrg.getChildByName("Arrow");e&&(e.opacity=255)}},t.prototype.hideMapArrow=function(){if(this.mapItemOrg){var e=this.mapItemOrg.getChildByName("Arrow");e&&255==e.opacity&&cc.tween(e).to(1.8,{opacity:0}).start()}},t.prototype.nextLevel=function(){this.curLevel++,this.curLevel>100&&(this.curLevel=1),this.gameState=a.GameConst.GAME_STATE_REPRARE,this.resetMap(),this.loadMap(),this.showMapArrow()},t.prototype.preLevel=function(){this.curLevel--,this.curLevel<1&&(this.curLevel=100),this.resetMap(),this.loadMap(),this.showMapArrow()},t.prototype.setNextBuildTowerType=function(e,t){this.nextBuildTowerType=parseInt(t)},t.prototype.sellTower=function(){if(this.selectTower){var e=this.selectTower.getType();cc.log("\u5356\u51fatower:"+e);var t=this.selectTower.node;if(t){var o=t.getPosition(),r=this.getMapGird(cc.v3(o.x,o.y,0)),n=50;switch(e){case a.GameConst.TOWER.TURRET:n=a.GameConst.TOWER_SELL_PRICE.TURRET;break;case a.GameConst.TOWER.ROCKET:n=a.GameConst.TOWER_SELL_PRICE.ROCKET;break;case a.GameConst.TOWER.LASER:n=a.GameConst.TOWER_SELL_PRICE.LASER;break;case a.GameConst.TOWER.UPGRADE:n=a.GameConst.TOWER_SELL_PRICE.UPGRADE+10*Math.floor(this.upgradeTowerBuildCount/2)}this.coinsCount+=n,this.updateCoinsCount(),e==a.GameConst.TOWER.UPGRADE?(this.degradedTowerByCenter(r),this.upgradeTowerBuildCount--,this.upgradeTowerBuildCount<0&&(this.upgradeTowerBuildCount=0),this.updatetowerUpgradePrice()):this.updateTowerUpgradeUIBySellTower(t,r),null!=this.mapTowerList[r.x]&&null!=this.mapTowerList[r.x]||(this.mapTowerList[r.x]=new Array),this.mapTowerList[r.x][r.y]=null;var i=new c.MapItemInfo;i.type=0,i.state=0,i.pos=cc.v3(o.x,o.y,0),null!=this.mapItemInfoList[r.x]&&null!=this.mapItemInfoList[r.x]||(this.mapItemInfoList[r.x]=new Array),this.mapItemInfoList[r.x][r.y]=i,t.destroy(),this.setSelectTower(null)}}},t.prototype.createEnemy=function(){switch(this.curWaveEnemyType){case a.GameConst.ENEMY.NORMAL:this.createOneEnemyNormal(this.pathPosWithNextDir,this.startPos,this.startDir,this.curWaveEnemyHP,this.curWaveEnemyCoins);break;case a.GameConst.ENEMY.FAST:this.createOneEnemyFase(this.pathPosWithNextDir,this.startPos,this.startDir,this.curWaveEnemyHP,this.curWaveEnemyCoins);break;case a.GameConst.ENEMY.BOSS:this.createOneEnemyBoss(this.pathPosWithNextDir,this.startPos,this.startDir,this.curWaveEnemyHP,this.curWaveEnemyCoins)}this.curWaveEnemyCreateCount++},t.prototype.startRun=function(){switch(this.testCreateType){case a.GameConst.ENEMY.NORMAL:this.createOneEnemyNormal(this.pathPosWithNextDir,this.startPos,this.startDir,10,1);break;case a.GameConst.ENEMY.FAST:this.createOneEnemyFase(this.pathPosWithNextDir,this.startPos,this.startDir,10,1);break;case a.GameConst.ENEMY.BOSS:this.createOneEnemyBoss(this.pathPosWithNextDir,this.startPos,this.startDir,10,1)}this.testCreateType++,this.testCreateType>2&&(this.testCreateType=0),this.hideMapArrow()},t.prototype.getNextWaveInfo=function(){var e=null;if(this.waveCount<this.waveTotal){this.waveCount++,this.updateWaveCount(),e=new c.WaveInfo;var t=10+this.waveCount,o=a.GameConst.ENEMY.NORMAL,r=15+this.waveCount;this.waveCount%10==0?o=a.GameConst.ENEMY.BOSS:this.waveCount%7==0&&(o=a.GameConst.ENEMY.FAST),e.count=5,e.createIntervalFPS=60,e.hp=t,e.coins=r,e.type=o}return e},t.prototype.update=function(){switch(this.gameState){case a.GameConst.GAME_STATE_REPRARE:cc.log("\u51c6\u5907\u4e2d...");break;case a.GameConst.GAME_STATE_WAIT_START:cc.log("\u7b49\u5f85\u5efa\u9020\u7b2c\u4e00\u4e2a\u70ae\u5854...");break;case a.GameConst.GAME_STATE_START:if(this.waveStart)this.curWaveFPS>=this.curWaveEnemyCreateFPS?(this.curWaveFPS=0,this.curWaveEnemyCreateCount<this.curWaveEnemyTotalCount&&(cc.log("\u521b\u5efaEnemy\uff01\uff01"),this.createEnemy())):this.curWaveFPS++;else if(this.curWaveEnemyTotalCount<=0)if(this.waveIntervalFPS>60){this.waveIntervalFPS=0,cc.log("\u83b7\u53d6\u4e0b\u4e00\u6ce2\u6570\u636e");var e=this.getNextWaveInfo();e?(this.waveStart=!0,this.curWaveEnemyTotalCount=e.count,this.curWaveEnemyType=e.type,this.curWaveEnemyHP=e.hp,this.curWaveEnemyCoins=e.coins,this.curWaveEnemyCreateFPS=e.createIntervalFPS,1==this.waveCount&&this.hideMapArrow()):cc.log("\u6ca1\u6709\u6570\u636e\u4e86")}else this.waveIntervalFPS++;break;case a.GameConst.GAME_STATE_GAME_OVER:cc.log("\u6e38\u620f\u7ed3\u675f\uff01\uff01\uff01\uff01\uff01");break;case a.GameConst.GAME_STATE_GAME_WIN:cc.log("\u6e38\u620f\u80dc\u5229VVVV\uff01\uff01\uff01\uff01\uff01")}},i([p(cc.Node)],t.prototype,"debugMapFrameLayer",void 0),i([p(cc.Label)],t.prototype,"levelLabel",void 0),i([p(cc.Node)],t.prototype,"mapLayer",void 0),i([p(cc.Node)],t.prototype,"frameLayer",void 0),i([p(cc.Node)],t.prototype,"mapOrgAndDesLayer",void 0),i([p(cc.Node)],t.prototype,"enemyLayer",void 0),i([p(cc.Node)],t.prototype,"bulletLayer",void 0),i([p(cc.Node)],t.prototype,"towerLayer",void 0),i([p(cc.Node)],t.prototype,"effectLayer",void 0),i([p(cc.Node)],t.prototype,"uiLayer",void 0),i([p(cc.Label)],t.prototype,"heartLabel",void 0),i([p(cc.Label)],t.prototype,"coinsLabel",void 0),i([p(cc.Label)],t.prototype,"waveLabel",void 0),i([p(cc.Label)],t.prototype,"towerUpgradePriceLabel",void 0),i([p(cc.Label)],t.prototype,"towerUpgradeSellPriceLabel",void 0),i([p(cc.Node)],t.prototype,"bottomLayer",void 0),i([p(cc.Node)],t.prototype,"towerBuildLayer",void 0),i([p(cc.Node)],t.prototype,"towerInfoLayer",void 0),i([p(cc.Node)],t.prototype,"towerBuildTrashLayer",void 0),i([p(cc.Node)],t.prototype,"waveInfoLayer",void 0),i([p(cc.Prefab)],t.prototype,"mapItemPrefab",void 0),i([p(cc.Prefab)],t.prototype,"mapItemOrgAndDesPrefab",void 0),i([p(cc.Prefab)],t.prototype,"enemyNormalPrefab",void 0),i([p(cc.Prefab)],t.prototype,"enemyFastPrefab",void 0),i([p(cc.Prefab)],t.prototype,"enemyBossPrefab",void 0),i([p(cc.Prefab)],t.prototype,"towerTurretPrefab",void 0),i([p(cc.Prefab)],t.prototype,"towerRocketPrefab",void 0),i([p(cc.Prefab)],t.prototype,"towerLaserPrefab",void 0),i([p(cc.Prefab)],t.prototype,"towerUpgradePrefab",void 0),i([p(cc.Prefab)],t.prototype,"bulletTurretPrefab",void 0),i([p(cc.Prefab)],t.prototype,"bulletRocketPrefab",void 0),i([p(cc.Prefab)],t.prototype,"effectExplodePrefab",void 0),i([p(cc.Node)],t.prototype,"towerRange",void 0),i([p(cc.Node)],t.prototype,"towerBuildRange",void 0),i([p(cc.Node)],t.prototype,"towerBuildCursor",void 0),i([h],t)}(cc.Component);o.default=u,cc._RF.pop()},{"./EventMananger":"EventMananger","./GameConst":"GameConst","./MapConfig":"MapConfig"}],GamePlatform:[function(e,t,o){"use strict";cc._RF.push(t,"537a8b2udhDbrHwP0xB9Fxp","GamePlatform"),Object.defineProperty(o,"__esModule",{value:!0}),o.GamePlatform=void 0;var r=function(){function e(){}return e.initRecord=function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx)return!1;if(console.log("winSize:",cc.winSize),e._top<=0){var t=wx.getSystemInfoSync(),o=t.windowWidth,r=t.windowHeight,n=o/cc.winSize.width;console.log("winSize:",o,"-",r),console.log("r:",n);var i=280*n;console.log("offsetY:",i),e._top=r/2+i,e._left=o/4+10,e._topClubBtn=180*n,e._leftClubBtn=20*n}var a=wx.getGameRecorder();a&&(console.log("[Record]init"),a.on("start",function(){console.log("[Record]\u5f00\u59cb\u5f55\u5236"),e.gameRecording=!0}),a.on("stop",function(t){e.gameRecording=!1,console.log("[Record]\u5bf9\u5c40\u56de\u653e\u65f6\u957f: "+t.duration)}),a.on("abort",function(){console.log("[Record]\u820d\u5f03\u5f55\u5236\uff01\uff01"),e.gameRecording=!1}))}},e.isFrameSupportedRecord=function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx)return!1;var e=wx.getGameRecorder();if(e)return console.log("[Record]\u662f\u5426\u652f\u6301\u5f55\u5236\u6e38\u620f\u753b\u9762:",e.isFrameSupported()),e.isFrameSupported()}return!1},e.clearTimeout=function(){},e.recordStart=function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx)return;try{var t=wx.getGameRecorder();t&&t.isFrameSupported()&&(t.start(),e.clearTimeout())}catch(o){}}},e.recordStop=function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx)return;if(!e.gameRecording)return;try{var t=wx.getGameRecorder();t&&t.isFrameSupported()&&(console.log("[Record]\u505c\u6b62\u5f55\u5236"),e.clearTimeout(),t.stop())}catch(o){}}},e.recordAbort=function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx)return;if(!e.gameRecording)return;try{var t=wx.getGameRecorder();t&&t.isFrameSupported()&&(console.log("[Record]\u820d\u5f03\u5f55\u5236"),t.abort(),e.clearTimeout())}catch(o){}}},e.hideGameRecorderShareButton=function(){e.gameRecorderShareButton&&(console.log("[Record]\u9690\u85cf\u6309\u94ae"),e.gameRecorderShareButton.hide())},e.createGameRecorderShareButton=function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx)return;console.log("\u5750\u6807\uff1a",e._left,",",e._top,",",0,",",50),e.gameRecorderShareButton?(console.log("[Record]\u663e\u793a\u6309\u94ae"),e.gameRecorderShareButton.show()):(console.log("[Record]\u521b\u5efa\u6309\u94ae"),e.gameRecorderShareButton=wx.createGameRecorderShareButton({style:{left:e._left,top:e._top,height:50,color:"#ffffff",textAlign:"center",fontSize:16,borderRadius:4,iconMarginRight:16,paddingLeft:1,paddingRight:30},text:"\u5206\u4eab\u901a\u5173\u89c6\u9891",share:{query:"a=1&b=2",timeRange:[[0,6e4]],title:{template:"default.score",data:{score:0}},button:{template:"default.enter"}}}))}},e.showShareMenu=function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx)return;console.log("\u663e\u793a\u5fae\u4fe1\u83dc\u5355\u5206\u4eab"),wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"],success:function(){console.log("\u5f00\u542f\u88ab\u52a8\u8f6c\u53d1\u6210\u529f\uff01")},fail:function(e){console.log(e),console.log("\u5f00\u542f\u88ab\u52a8\u8f6c\u53d1\u5931\u8d25\uff01")}}),e.shareStartTimestamp=(new Date).getTime(),wx.onShareAppMessage(function(){return{title:"\u8da3\u5473\u5341\u8db3\u7684\u7269\u7406\u89e3\u8c1c\u6e38\u620f\uff01\u6562\u6311\u6218\u5417\uff1f",query:"shareMsg=OneBallPuzzle#123#"}})}},e.share=function(t,o){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx)return;var r="",n="";switch(t){case e.SHARE_TYPE_WX_MENU:console.log("\u5fae\u4fe1\u83dc\u5355\u5206\u4eab"),r="\u8fd9\u5173\u4e0d\u597d\u8fc7\uff0c\u5e2e\u6211\u8fc7\u4e00\u4e0b\uff01";break;case e.SHARE_TYPE_GAME_MENU:console.log("\u6e38\u620f\u83dc\u5355\u5206\u4eab"),r="",n="uid="+e.uuid;break;case e.SHARE_TYPE_GAME_LEVEL:console.log("\u6e38\u620f\u5173\u5361\u5206\u4eab\uff1a"+o),r="\u6211\u7684\u5173\u5361\u8d85\u96be\uff01\u7b49\u4f60\u6765\u6311\u6218\uff01",n="uid="+e.uuid+"&level="+o;var i=""+o;e.aldEvent("\u5206\u4eab\u5173\u5361","\u5206\u4eab\u5173\u5361",i)}e.shareStartTimestamp=(new Date).getTime(),t!=e.SHARE_TYPE_WX_MENU?cc.loader.loadRes("share_1",function(e,t){wx.shareAppMessage({imageUrl:t.url,title:r,query:n,success:function(e){wx.showToast({title:"\u5206\u4eab\u6210\u529f"}),console.log("\u5206\u4eab\u6210\u529f"+e)},fail:function(e){console.log("\u5206\u4eab\u5931\u8d25"+e)}})}):wx.shareAppMessage({title:r,success:function(e){wx.showToast({title:"\u5206\u4eab\u6210\u529f"}),console.log("\u5206\u4eab\u6210\u529f"+e)},fail:function(e){console.log("\u5206\u4eab\u5931\u8d25"+e)}})}},e.createGameClubButton=function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx)return;console.log("Club\u5750\u6807\uff1a",e._leftClubBtn,",",e._topClubBtn,",",0,",",50),e.gameClubButton?(console.log("[Club]\u663e\u793a\u6309\u94ae"),e.gameClubButton.show()):(console.log("[Club]\u521b\u5efa\u6309\u94ae"),e.gameClubButton=wx.createGameClubButton({icon:"white",style:{left:e._leftClubBtn,top:e._topClubBtn,width:30,height:30}}))}},e.hideClubBtn=function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx)return;e.gameClubButton&&(console.log("[Club]\u9690\u85cf\u6309\u94ae"),e.gameClubButton.hide())}},e.getLaunchParam=function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx)return;console.log("\u83b7\u53d6\u767b\u5f55\u53c2\u6570wx\u767b\u5f55\u53c2\u6570");var e=wx.getEnterOptionsSync();if(console.log(e),e.query)return console.log("wx\u767b\u5f55\u53c2\u6570:",e.query),e.query;console.log("\u5fae\u4fe1\u5e73\u53f0\u65e0\u900f\u4f20\u53c2\u6570")}return null},e.checkForUpdate=function(){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx)return;console.log("\u7248\u672c\u5347\u7ea7\u68c0\u67e5\uff01");var e=wx.getUpdateManager();e.onCheckForUpdate(function(e){console.log(e.hasUpdate)}),e.onUpdateReady(function(){wx.showModal({title:"\u66f4\u65b0\u63d0\u793a",content:"\u65b0\u7248\u672c\u5df2\u7ecf\u51c6\u5907\u597d\uff0c\u662f\u5426\u91cd\u542f\u5e94\u7528\uff1f",success:function(t){t.confirm&&e.applyUpdate()}})}),e.onUpdateFailed(function(){console.log("\u7248\u672c\u65b0\u7248\u672c\u4e0b\u8f7d\u5931\u8d25\uff01")})}},e.aldEvent=function(t,o,r){if(cc.sys.platform===cc.sys.WECHAT_GAME){if("undefined"==typeof wx||null==t)return;console.log("===============\u4e8b\u4ef6\u7edf\u8ba1================="),console.log("eventName="+t),console.log("pKey="+o),console.log("pValue="+r);try{wx.aldSendEvent(t,{uuid:e.uuid,pKey:r})}catch(n){}console.log("===============\u4e8b\u4ef6\u7edf\u8ba1=================")}},e.uuid=null,e.adBanner=null,e.shareStartTimestamp=0,e.SHARE_TYPE_WX_MENU=0,e.SHARE_TYPE_GAME_MENU=1,e.SHARE_TYPE_GAME_LEVEL=2,e._top=0,e._left=0,e.gameRecording=!1,e.timeoutID=0,e._topClubBtn=0,e._leftClubBtn=0,e}();o.GamePlatform=r,cc._RF.pop()},{}],Global:[function(e,t,o){"use strict";cc._RF.push(t,"b332fgoPXlL0atbAvaOXYZd","Global"),Object.defineProperty(o,"__esModule",{value:!0}),o.Global=void 0;var r=e("./GameConst"),n=e("./platform/GamePlatform");(function(e){function t(e){var t=r.GameConst.DATA_KEY_TUTORIAL_LEVEL,o=0;switch(e){case r.GameConst.LEVEL_GROUP_TUTORIAL:t=r.GameConst.DATA_KEY_TUTORIAL_LEVEL,o=1;break;case r.GameConst.LEVEL_GROUP_EASY:t=r.GameConst.DATA_KEY_EASY_LEVEL;break;case r.GameConst.LEVEL_GROUP_NORMAL:t=r.GameConst.DATA_KEY_NORMAL_LEVEL;break;case r.GameConst.LEVEL_GROUP_HARD:t=r.GameConst.DATA_KEY_HARD_LEVEL;break;case r.GameConst.LEVEL_GROUP_VERY_HADR:t=r.GameConst.DATA_KEY_VERY_HARD_LEVEL}return cc.sys.localStorage.getItem(t)?Number(cc.sys.localStorage.getItem(t)):o}function o(e,t){cc.sys.localStorage.setItem(e,Number(t))}function i(e){return cc.sys.localStorage.getItem(e)?Number(cc.sys.localStorage.getItem(e)):0}function a(e,t){var o=cc.sys.localStorage.getItem(e);return null!=o&&null!=o?Number(cc.sys.localStorage.getItem(e)):t}function s(){return cc.sys.localStorage.getItem(r.GameConst.DATA_KEY_PASS_PLAYER_LEVEL)?cc.sys.localStorage.getItem(r.GameConst.DATA_KEY_PASS_PLAYER_LEVEL):null}function c(){return i(r.GameConst.DATA_KEY_PASS_PLAYER_LEVEL)}function l(){return i(r.GameConst.DATA_KEY_STAR_COUNT)}function h(){var e=cc.sys.localStorage.getItem(r.GameConst.DATA_KEY_MY_LEVEL_GRID_STATE);return e||(e=r.GameConst.DEF_MY_LEVEL_GIRD_STATE),console.log("getMyLevelGird="+e),e}function p(){var e=cc.sys.localStorage.getItem(r.GameConst.DATA_KEY_FRIEND_LEVEL_GRID_STATE);return e||(e=r.GameConst.DEF_FRIEND_LEVEL_GIRD_STATE),console.log("getFriendLevelGird="+e),e}e.currentLevelGroup=r.GameConst.LEVEL_GROUP_TUTORIAL,e.currentLevel=1,e.currentBgIndex=1,e.testCount=0,e.gameState=-1,e.speedRate=1,e.invertControls=1,e.debug=!1,e.debugLevel=!1,e.fromGame=!1,e.editModeLevel=-1,e.editMode=!1,e.editMapData=null,e.editMapTipData=null,e.passTest=!1,e.challengeMode=!1,e.challengeMapData=null,e.challengeModeLevel=-1,e.lastScene=null,e.receiveMapData=null,e.lastReceiveMapData=null,e.levelStarCount=0,e.isRecordOn=!1,e.isFrameSupported=!1,e.setUUID=function(e){cc.sys.localStorage.setItem(r.GameConst.DATA_KEY_UUID,e)},e.getUUID=function(){return cc.sys.localStorage.getItem(r.GameConst.DATA_KEY_UUID)?cc.sys.localStorage.getItem(r.GameConst.DATA_KEY_UUID):null},e.saveLastReceiveLevel=function(e){var t=r.GameConst.DATA_KEY_LAST_RECEIVE_LEVEL;cc.log("last\u4fdd\u5b58\u6536\u5230\u6570\u636emapData="+e),cc.sys.localStorage.setItem(t,String(e))},e.getLastReceiveLevel=function(){var e=r.GameConst.DATA_KEY_LAST_RECEIVE_LEVEL,t=cc.sys.localStorage.getItem(e);return t?(cc.log("last\u83b7\u53d6\u6536\u5230\u6570\u636emapData="+t),String(t)):(cc.log("last\u83b7\u53d6\u6536\u5230\u6570\u636emapData=null"),null)},e.getLaunchParam=function(){var t=n.GamePlatform.getLaunchParam();if(t){console.log("###################"),console.log("\u6536\u5230wx\u767b\u5f55\u53c2\u6570query:",t);var o=t.level,r=t.uid,i=e.getUUID();if(console.log("level:",o),console.log("uid:",r),console.log("curUuid:",i),i!=r&&o)return e.receiveMapData=o,console.log("###################"),o;console.log("###################")}return null},e.updateAudioVolume=function(){var t=e.getMusicOn(),o=e.getSFXOn();t===r.GameConst.YES?cc.audioEngine.setMusicVolume(.3):cc.audioEngine.setMusicVolume(0),o===r.GameConst.YES?cc.audioEngine.setEffectsVolume(.3):cc.audioEngine.setEffectsVolume(0)},e.saveCurBgIndex=function(e){o(r.GameConst.DATA_KEY_CUR_BG_INDEX,Number(e))},e.getCurBgIndex=function(){return i(r.GameConst.DATA_KEY_CUR_BG_INDEX)},e.saveEditLevel=function(e,t){var o=r.GameConst.DATA_KEY_EDIT_LEVEL+"_"+e;cc.sys.localStorage.setItem(o,String(t))},e.getEditLevel=function(e){var t=r.GameConst.DATA_KEY_EDIT_LEVEL+"_"+e,o=cc.sys.localStorage.getItem(t);return o?String(o):null},e.saveEditPassLevel=function(e,t){var o=r.GameConst.DATA_KEY_EDIT_PASS_LEVEL+"_"+e;cc.sys.localStorage.setItem(o,String(t))},e.getEditPassLevel=function(e){var t=r.GameConst.DATA_KEY_EDIT_PASS_LEVEL+"_"+e,o=cc.sys.localStorage.getItem(t);return o?String(o):null},e.saveReceiveLevel=function(e,t){var o=r.GameConst.DATA_KEY_RECEIVE_LEVEL+"_"+e;cc.sys.localStorage.setItem(o,String(t))},e.getReceiveLevel=function(e){var t=r.GameConst.DATA_KEY_RECEIVE_LEVEL+"_"+e,o=cc.sys.localStorage.getItem(t);return o?String(o):null},e.saveCurLevel=function(e){o(r.GameConst.DATA_KEY_CUR_LEVEL,Number(e))},e.getCurLevel=function(){return i(r.GameConst.DATA_KEY_CUR_LEVEL)},e.saveCurLevelGroup=function(e){o(r.GameConst.DATA_KEY_CUR_LEVEL_GROUP,Number(e))},e.getCurLevelGroup=function(){return i(r.GameConst.DATA_KEY_CUR_LEVEL_GROUP)},e.saveLevel=function(e,o){if(!(o<0||t(e)>=o)){var n=r.GameConst.DATA_KEY_TUTORIAL_LEVEL;switch(e){case r.GameConst.LEVEL_GROUP_TUTORIAL:n=r.GameConst.DATA_KEY_TUTORIAL_LEVEL;break;case r.GameConst.LEVEL_GROUP_EASY:n=r.GameConst.DATA_KEY_EASY_LEVEL;break;case r.GameConst.LEVEL_GROUP_NORMAL:n=r.GameConst.DATA_KEY_NORMAL_LEVEL;break;case r.GameConst.LEVEL_GROUP_HARD:n=r.GameConst.DATA_KEY_HARD_LEVEL;break;case r.GameConst.LEVEL_GROUP_VERY_HADR:n=r.GameConst.DATA_KEY_VERY_HARD_LEVEL}cc.sys.localStorage.setItem(n,Number(o))}},e.getLevel=t,e.getLevelGroupName=function(e){var t="";switch(e){case r.GameConst.LEVEL_GROUP_TUTORIAL:t="\u6559\u5b66";break;case r.GameConst.LEVEL_GROUP_EASY:t="\u7b80\u5355";break;case r.GameConst.LEVEL_GROUP_NORMAL:t="\u666e\u901a";break;case r.GameConst.LEVEL_GROUP_HARD:t="\u56f0\u96be";break;case r.GameConst.LEVEL_GROUP_VERY_HADR:t="\u6781\u96be"}return t},e.saveMusicOn=function(e){cc.sys.localStorage.setItem(r.GameConst.DATA_KEY_SOUND_MUSIC,Number(e))},e.saveSFXOn=function(e){cc.sys.localStorage.setItem(r.GameConst.DATA_KEY_SOUND_FX,Number(e))},e.getMusicOn=function(){return a(r.GameConst.DATA_KEY_SOUND_MUSIC,1)},e.getSFXOn=function(){return a(r.GameConst.DATA_KEY_SOUND_FX,1)},e.saveRecordOn=function(e){cc.sys.localStorage.setItem(r.GameConst.DATA_KEY_RECORD_ON,Number(e))},e.getRecordOn=function(){return a(r.GameConst.DATA_KEY_RECORD_ON,0)},e.saveMaxData=function(e,t){var o=i(e);o?o<t&&cc.sys.localStorage.setItem(e,t):cc.sys.localStorage.setItem(e,t)},e.saveData=o,e.getData=i,e.getDataWithDef=a,e.saveOpenIdData=function(e){cc.sys.localStorage.setItem("OPEN_ID",e)},e.getOpenIdData=function(){return cc.sys.localStorage.getItem("OPEN_ID")?cc.sys.localStorage.getItem("OPEN_ID"):null},e.getPassPlayerLevelAllToArray=function(){var e=s(),t=[];if(e)for(var o=e.split(""),n=o.length,i=0;i<n;i++){var a=Number(o[i]);t[i]=a}else for(i=0;i<r.GameConst.LEVEL_GROUP_PLAYER_COUNT;i++)t[i]=0;return t},e.savePassPlayerLevelAll=function(e){cc.sys.localStorage.setItem(r.GameConst.DATA_KEY_PASS_PLAYER_LEVEL,e)},e.getPassPlayerLevelAll=s,e.savePassPlayerLevel=function(e){e>c()&&o(r.GameConst.DATA_KEY_PASS_PLAYER_LEVEL,Number(e))},e.getPassPlayerLevel=c,e.isGameOver=function(){return e.gameState==r.GameConst.GAME_STATE_GAME_OVER},e.isGamePause=function(){return e.gameState==r.GameConst.GAME_STATE_PAUSE},e.isGameWaitContinue=function(){return e.gameState==r.GameConst.GAME_STATE_WAIT_CONTINUE},e.isGameSetting=function(){return e.gameState==r.GameConst.GAME_STATE_SETTING},e.isGameShowTip=function(){return e.gameState==r.GameConst.GAME_STATE_SHOW_TIP},e.isGameRuning=function(){return e.gameState==r.GameConst.GAME_STATE_RUN},e.addStar=function(e){if(e>0){var t=l()+e;o(r.GameConst.DATA_KEY_STAR_COUNT,Number(t))}},e.costStat=function(e){if(e>0){var t=l();if(t>e){var n=t-e;o(r.GameConst.DATA_KEY_STAR_COUNT,Number(n))}}},e.saveStarCount=function(e){o(r.GameConst.DATA_KEY_STAR_COUNT,Number(e))},e.getStarCount=l,e.getMyLevelGird=h,e.isMyLevelLocked=function(){return 0==i(r.GameConst.DATA_KEY_UNLOCK_MY_LEVEL)},e.unlockMyLevel=function(){o(r.GameConst.DATA_KEY_UNLOCK_MY_LEVEL,Number(1))},e.unlockMyLevelGird=function(e){for(var t=h().split(""),o=t.length,n="",i=0;i<o;i++){var a=String(t[i]);n+=e==i?"1":a}console.log("unlockMyLevelGird="+n),cc.sys.localStorage.setItem(r.GameConst.DATA_KEY_MY_LEVEL_GRID_STATE,n)},e.isMyLevelGirdUnLocked=function(e,t){if(t){var o=t.split(""),r=o.length;if(e>=0&&e<r&&1===Number(o[e]))return!0}return!1},e.getFriendLevelGird=p,e.unlockFriendLevelGird=function(e){for(var t=p().split(""),o=t.length,n="",i=0;i<o;i++){var a=String(t[i]);n+=e==i?"1":a}cc.sys.localStorage.setItem(r.GameConst.DATA_KEY_FRIEND_LEVEL_GRID_STATE,n)},e.isFriendLevelGirdUnLocked=function(e,t){if(t){var o=t.split(""),r=o.length;if(e>=0&&e<r&&1===Number(o[e]))return!0}return!1},e.block2MapId=function(e,t){for(var o=0;o<r.GameConst.LEVEL_ID_2_BLOCK_MAP.length;o++){var n=r.GameConst.LEVEL_ID_2_BLOCK_MAP[o];if(n.type==e&&n.dir===t)return o}return-1},e.levelData2Ids=function(e){if(!e)return null;for(var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),o=e.length,r=[],n=t.length,i=0;i<o;i++)for(var a=0;a<n;a++)if(String(e.charAt(i))===String(t[a])){r[i]=a;break}return r},e.levelId2Data=function(e){if(e<0)return null;var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ".split("");return e<t.length?t[e]:null},e.levelIds2Data=function(e){if(!e)return null;for(var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),o=e.length,r=t.length,n="",i=0;i<o;i++){var a=e[i];a<r&&(n+=t[a])}return n},e.getRandom=function(e,t){var o=t-e+1;return e+Math.floor(Math.random()*o)},e.shuffle=function(e){var t,o=0,r=0;for(o=e.length-1;o>0;o--)r=Math.floor(Math.random()*(o+1)),t=e[o],e[o]=e[r],e[r]=t;return e}})(o.Global||(o.Global={})),cc._RF.pop()},{"./GameConst":"GameConst","./platform/GamePlatform":"GamePlatform"}],MapConfig:[function(e,t,o){"use strict";cc._RF.push(t,"a7651w8FpxHiLultvYCHafa","MapConfig"),Object.defineProperty(o,"__esModule",{value:!0}),o.WaveInfo=o.MapItemInfo=o.PathPosWithNextDir=o.MapConfig=o.Path=o.Field=void 0;o.Field=function(){};o.Path=function(){};o.MapConfig=function(){};o.PathPosWithNextDir=function(){};o.MapItemInfo=function(){};o.WaveInfo=function(){},cc._RF.pop()},{}],MapItem:[function(e,t,o){"use strict";cc._RF.push(t,"035f8+IdidAb5uwUT9zSm0j","MapItem");var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.init=function(){},t.prototype.start=function(){},i([s],t)}(cc.Component));o.default=c,cc._RF.pop()},{}],MapOrgAndDes:[function(e,t,o){"use strict";cc._RF.push(t,"b3edcRxnpZOrboPWzuU3Q8l","MapOrgAndDes");var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./GameConst"),s=cc._decorator,c=s.ccclass,l=s.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.arrowNode=null,t}return n(t,e),t.prototype.hideArrow=function(){this.arrowNode&&(this.arrowNode.active=!1)},t.prototype.init=function(e,t,o){if(this.node){switch(cc.log("MapOrgAndDes init type="+e),cc.log("MapOrgAndDes init pos="+o),cc.log("MapOrgAndDes init dir="+t),e){case a.GameConst.MAP_ITEM_TYPE.ORIGIN:this.node.color=cc.Color.CYAN,this.arrowNode&&(this.arrowNode.color=cc.Color.CYAN,this.arrowNode.active=!0);break;case a.GameConst.MAP_ITEM_TYPE.DESTINATION:this.node.color=cc.Color.ORANGE,this.arrowNode&&(this.arrowNode.active=!1)}switch(this.node.setPosition(o),t){case a.GameConst.DIR.TOP:this.node.angle=180;break;case a.GameConst.DIR.BOTTOM:this.node.angle=0;break;case a.GameConst.DIR.LEFT:this.node.angle=270;break;case a.GameConst.DIR.RIGHT:this.node.angle=90}}},t.prototype.start=function(){},i([l(cc.Node)],t.prototype,"arrowNode",void 0),i([c],t)}(cc.Component);o.default=h,cc._RF.pop()},{"./GameConst":"GameConst"}],NodeAction:[function(e,t,o){"use strict";cc._RF.push(t,"8d7453hi0JHcZC5GpebKtqT","NodeAction");var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=0,t.delay=0,t}return n(t,e),t.prototype.start=function(){switch(this.type){case 0:this.doRate();break;case 1:this.doScale();break;case 3:this.doBlink();break;case 4:this.doDiffuse(!0,.5);break;case 5:this.doDiffuse(!1,.4);break;case 6:this.doFade();break;case 7:this.doMove()}},t.prototype.collapse=function(){this.node&&(this.node.active=!0,this.node.setScale(1),this.node.opacity=255,cc.tween(this.node).to(.5,{scaleY:0,opacity:0}).start())},t.prototype.expand=function(){this.node&&(this.node.active=!0,this.node.setScale(1,0,1),this.node.opacity=0,cc.tween(this.node).to(.5,{scaleY:1,opacity:255}).start())},t.prototype.showEffectDes=function(){this.node&&(this.node.active=!0,this.node.setScale(1),this.node.opacity=100,cc.tween(this.node).delay(this.delay).to(.5,{scale:10,opacity:0}).start())},t.prototype.showEffectDesWithScaleValue=function(e){this.node&&(this.node.active=!0,this.node.setScale(1),this.node.opacity=100,cc.tween(this.node).delay(this.delay).to(1,{scale:e,opacity:0}).start())},t.prototype.doDiffuse=function(e,t){var o=this;this.node&&(this.node.setScale(1),this.node.opacity=255,cc.tween(this.node).to(.9*t,{scale:1.7,opacity:200}).to(.1*t,{scale:1.8,opacity:0}).call(function(){o.node.parent&&o.node.parent.destroy()}).start())},t.prototype.doFlash=function(){this.node&&(this.node.stopAllActions(),cc.tween(this.node).repeatForever(cc.tween(this.node).delay(.5).to(.01,{opacity:0}).delay(.5).to(.01,{opacity:255})).start())},t.prototype.doMove=function(){this.node&&cc.tween(this.node).delay(3).repeatForever(cc.tween(this.node).by(.6,{position:cc.v3(0,10,0)}).by(.6,{position:cc.v3(0,-10,0)})).start()},t.prototype.doBlink=function(){this.node&&(this.node.stopAllActions(),cc.tween(this.node).repeatForever(cc.tween(this.node).to(.5,{scale:1.1}).to(.5,{scale:1})).start())},t.prototype.doFade=function(){var e=this;this.node&&(this.node.stopAllActions(),this.node.opacity=0,cc.tween(this.node).repeatForever(cc.tween(this.node).to(.5,{scale:.8,opacity:255}).delay(.5).to(.5,{scale:.7}).delay(.5).to(.5,{opacity:0}).delay(.5).call(function(){e.node.scale=.8})).start())},t.prototype.doRate=function(){this.node&&(this.node.stopAllActions(),cc.tween(this.node).by(2,{angle:-360}).repeatForever().start())},t.prototype.doScale=function(){var e=this;this.node&&(this.node.stopAllActions(),cc.tween(this.node).delay(this.delay).repeatForever(cc.tween(this.node).to(2,{scale:.2,opacity:20}).call(function(){e.node.setScale(1),e.node.opacity=0}).to(.8,{scale:1,opacity:255})).start())},t.prototype.showStartBtnEffect=function(){var e=this;this.node&&(this.node.stopAllActions(),this.node.opacity=125,cc.tween(this.node).repeatForever(cc.tween(this.node).to(2,{scale:2.5,opacity:10},{easing:"quadOut"}).call(function(){e.node.setScale(1),e.node.opacity=125})).start())},t.prototype.resetNode=function(){this.node&&(this.node.setScale(1),this.node.stopAllActions(),this.node.opacity=100,this.node.active=!1)},t.prototype.stopAllActions=function(){this.node&&this.node.stopAllActions()},i([c],t.prototype,"type",void 0),i([c],t.prototype,"delay",void 0),i([s],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],Tower:[function(e,t,o){"use strict";cc._RF.push(t,"0bd8a0l2mtIB4XZyUjEYYCo","Tower");var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./GameConst"),s=e("./EventMananger"),c=cc._decorator,l=c.ccclass,h=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=0,t.levelLabel=null,t.gameManager=null,t.level=1,t.damage=5,t.sellPrice=20,t.cd=.3,t.range=cc.size(93,93),t.enemyTargetList=new Array,t.actionFPS=0,t.shootFPS=0,t.laserShowFPS=0,t.towerId=0,t.upgradeTowerEnableDirTop=!1,t.upgradeTowerEnableDirBottom=!1,t.upgradeTowerEnableDirLeft=!1,t.upgradeTowerEnableDirRight=!1,t.upgradeTowerEnableDirLeftTop=!1,t.upgradeTowerEnableDirLeftBottom=!1,t.upgradeTowerEnableDirRightTop=!1,t.upgradeTowerEnableDirRightBottom=!1,t.hasShoot=!1,t.headRockTime=0,t.headRockStart=!1,t}return n(t,e),t.prototype.onEnable=function(){s.EventMananger.getInstance().addEvent(a.GameConst.EVENT_REMOVE_ENEMY,this.removeEnemy,this),s.EventMananger.getInstance().addEvent(a.GameConst.EVENT_HIDE_RANGE,this.hideRange,this),this.node.on(cc.Node.EventType.TOUCH_END,this.touchEnd,this)},t.prototype.onDisable=function(){s.EventMananger.getInstance().removeEvent(a.GameConst.EVENT_REMOVE_ENEMY,this.removeEnemy,this),s.EventMananger.getInstance().removeEvent(a.GameConst.EVENT_HIDE_RANGE,this.hideRange,this),this.node.off(cc.Node.EventType.TOUCH_END,this.touchEnd,this)},t.prototype.touchEnd=function(){this.gameManager&&this.gameManager.setSelectTower(this)},t.prototype.init=function(e,t,o){switch(this.type=e,this.gameManager=t,this.type){case a.GameConst.TOWER.TURRET:this.damage=5,this.cd=.3,this.sellPrice=20,this.range=cc.size(279,279);break;case a.GameConst.TOWER.ROCKET:this.damage=16,this.cd=1.5,this.sellPrice=20,this.range=cc.size(465,465);break;case a.GameConst.TOWER.LASER:this.damage=50,this.cd=5,this.sellPrice=20,this.shootFPS=a.GameConst.TOWER_LASER_SHOOT_FPS,this.range=cc.size(651,651);break;case a.GameConst.TOWER.UPGRADE:this.damage=0,this.cd=0,this.sellPrice=50}this.towerId=o},t.prototype.updateUpgradeTowerUI=function(){if(this.node){var e=this.node.getChildByName("top");e&&(e.active=this.upgradeTowerEnableDirTop);var t=this.node.getChildByName("bottom");t&&(t.active=this.upgradeTowerEnableDirBottom);var o=this.node.getChildByName("left");o&&(o.active=this.upgradeTowerEnableDirLeft);var r=this.node.getChildByName("right");r&&(r.active=this.upgradeTowerEnableDirRight);var n=this.node.getChildByName("left_top");n&&(n.active=this.upgradeTowerEnableDirLeftTop);var i=this.node.getChildByName("left_bottom");i&&(i.active=this.upgradeTowerEnableDirLeftBottom);var a=this.node.getChildByName("right_top");a&&(a.active=this.upgradeTowerEnableDirRightTop);var s=this.node.getChildByName("right_bottom");s&&(s.active=this.upgradeTowerEnableDirRightBottom)}},t.prototype.setUpgradeTowerDir=function(e,t,o){switch(e){case a.GameConst.TOWER_DIR.TOP:this.upgradeTowerEnableDirTop=t;break;case a.GameConst.TOWER_DIR.BOTTOM:this.upgradeTowerEnableDirBottom=t;break;case a.GameConst.TOWER_DIR.LEFT:this.upgradeTowerEnableDirLeft=t;break;case a.GameConst.TOWER_DIR.RIGHT:this.upgradeTowerEnableDirRight=t;break;case a.GameConst.TOWER_DIR.LEFT_TOP:this.upgradeTowerEnableDirLeftTop=t;break;case a.GameConst.TOWER_DIR.LEFT_BOTTOM:this.upgradeTowerEnableDirLeftBottom=t;break;case a.GameConst.TOWER_DIR.RIGHT_TOP:this.upgradeTowerEnableDirRightTop=t;break;case a.GameConst.TOWER_DIR.RIGHT_BOTTOM:this.upgradeTowerEnableDirRightBottom=t}o&&this.updateUpgradeTowerUI()},t.prototype.upgrade=function(){this.level++,this.level>8&&(this.level=8),this.updateLevelLabel()},t.prototype.degrade=function(){this.level--,this.level<1&&(this.level=1),this.updateLevelLabel()},t.prototype.setLevel=function(e){e>0&&(this.level=e)},t.prototype.updateLevelLabel=function(){this.levelLabel&&(this.levelLabel.string=""+this.level)},t.prototype.getDamage=function(){return this.damage*this.level},t.prototype.getSellPrice=function(){return this.sellPrice},t.prototype.getCD=function(){return this.cd},t.prototype.getRange=function(){return this.range},t.prototype.hideRange=function(e){if(this.node&&this.towerId!=e){var t=this.node.getChildByName("range");t&&(t.active=!1)}},t.prototype.showRange=function(){if(this.node){s.EventMananger.getInstance().sendEvent(a.GameConst.EVENT_HIDE_RANGE,this.towerId);var e=this.node.getChildByName("range");e&&(e.active=!0)}},t.prototype.getType=function(){return this.type},t.prototype.shoot=function(){if(this.gameManager)switch(this.type){case a.GameConst.TOWER.TURRET:this.headRockStart=!0,this.gameManager.createOneBulletTurret(this);break;case a.GameConst.TOWER.ROCKET:this.headRockStart=!0,this.gameManager.createOneBulletRocket(this);break;case a.GameConst.TOWER.LASER:var e=this.node.getChildByName("head");if(e){this.rotateTower();var t=this.getTargetEnemy(),o=t.getPosition().sub(this.node.getPosition()).mag();e.height=o,e.active=!0,this.laserShowFPS=5,this.updateTowerLaserProgress(0);var r=t.getComponent("Enemy");r&&(r.isDead()||r.beHit(this.damage))}}},t.prototype.headRock=function(){if(this.node){var e=this.node.getChildByName("head");if(e)if(this.headRockTime++,e.getPosition(),this.headRockStart){this.headRockStart=!1;var t=e.angle,o=cc.misc.degreesToRadians(t),r=cc.v2(0,-3).rotate(o);e.setPosition(r)}else e.setPosition(0,0),this.headRockTime=0}},t.prototype.removeEnemy=function(e){if(this.enemyTargetList)for(var t=this.enemyTargetList.length-1;t>=0;t--){var o=this.enemyTargetList[t],r=!1;if(o)if(o&&o.isValid&&o.active){var n=o.getComponent("Enemy");if(n){if(e==n.getEnemyId()){r=!0;break}}else r=!0}else r=!0;r&&this.removeEnemyFromTargetList(o)}},t.prototype.removeEnemyFromTargetList=function(e){if(e&&this.enemyTargetList){var t=this.enemyTargetList.indexOf(e);t>-1&&this.enemyTargetList.splice(t,1)}},t.prototype.addEnemyToTargetList=function(e){e&&(null!=this.enemyTargetList&&null!=this.enemyTargetList||(this.enemyTargetList=new Array),this.enemyTargetList.push(e))},t.prototype.onCollisionEnter=function(e){e.node&&e.node.isValid&&e.node.active&&e.node.getComponent("Enemy")&&this.addEnemyToTargetList(e.node)},t.prototype.onCollisionExit=function(e){this.removeEnemyFromTargetList(e.node)},t.prototype.start=function(){},t.prototype.getTargetEnemy=function(){if(this.enemyTargetList)for(var e=this.enemyTargetList.length,t=0;t<e;t++){var o=this.enemyTargetList[t];if(o&&o.isValid&&o.active){var r=o.getComponent("Enemy");if(r&&!r.isDead())return o}}return null},t.prototype.rotateTower=function(){switch(this.type){case a.GameConst.TOWER.TURRET:case a.GameConst.TOWER.ROCKET:case a.GameConst.TOWER.LASER:var e=this.getTargetEnemy();if(e){var t=this.node.position.sub(e.position),o=cc.v2(t.x,t.y),r=cc.v2(cc.v2(0,-1)).signAngle(o),n=180/Math.PI*r,i=this.node.getChildByName("head");i&&(i.angle=n)}}},t.prototype.updateTowerLaserProgress=function(e){if(this.type==a.GameConst.TOWER.LASER){var t=this.node.getChildByName("progress");t&&(t.width=Math.floor(85*e))}},t.prototype.update=function(){if(this.node&&this.type!=a.GameConst.TOWER.UPGRADE){if(this.actionFPS<a.GameConst.TOWER_ACTION_FPS-1)this.actionFPS++;else switch(this.actionFPS=0,this.type){case a.GameConst.TOWER.TURRET:case a.GameConst.TOWER.ROCKET:this.rotateTower(),(this.headRockStart||this.headRockTime>0)&&this.headRock();break;case a.GameConst.TOWER.LASER:}if(this.laserShowFPS>0&&(this.laserShowFPS--,this.laserShowFPS<=0&&this.type==a.GameConst.TOWER.LASER)){var e=this.node.getChildByName("head");e&&e.active&&(e.active=!1)}if(this.getTargetEnemy()){var t=1;switch(this.type){case a.GameConst.TOWER.TURRET:t=a.GameConst.TOWER_TURRET_SHOOT_FPS;break;case a.GameConst.TOWER.ROCKET:t=a.GameConst.TOWER_ROCKET_SHOOT_FPS;break;case a.GameConst.TOWER.LASER:t=a.GameConst.TOWER_LASER_SHOOT_FPS}if(this.shootFPS<t-1){if(this.shootFPS++,this.type==a.GameConst.TOWER.LASER){var o=this.shootFPS/t;this.updateTowerLaserProgress(o)}}else this.shootFPS=0,this.shoot()}else this.type==a.GameConst.TOWER.LASER&&this.shootFPS<a.GameConst.TOWER_LASER_SHOOT_FPS-1&&(this.shootFPS++,this.type==a.GameConst.TOWER.LASER)&&(o=this.shootFPS/a.GameConst.TOWER_LASER_SHOOT_FPS,this.updateTowerLaserProgress(o))}},i([h],t.prototype,"type",void 0),i([h(cc.Label)],t.prototype,"levelLabel",void 0),i([l],t)}(cc.Component);o.default=p,cc._RF.pop()},{"./EventMananger":"EventMananger","./GameConst":"GameConst"}]},{},["BulletBase","BulletRocket","BulletTurret","DrawBg","DrawFrame","Enemy","EventMananger","ExplodeEffect","GameConst","GameManager","Global","MapConfig","MapItem","MapOrgAndDes","NodeAction","Tower","GamePlatform"]);